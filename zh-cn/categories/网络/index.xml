<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>ç½‘ç»œ on Nansen Li</title>
        <link>https://nansenli.com/zh-cn/categories/%E7%BD%91%E7%BB%9C/</link>
        <description>Recent content in ç½‘ç»œ on Nansen Li</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-cn</language>
        <copyright>Nansen Li ğŸŒˆ ï¼ˆææ¥ æ£®ï¼‰</copyright>
        <lastBuildDate>Tue, 11 Dec 2018 10:50:00 +0000</lastBuildDate><atom:link href="https://nansenli.com/zh-cn/categories/%E7%BD%91%E7%BB%9C/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>socketioå­¦ä¹ </title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/socket-io%E5%AD%A6%E4%B9%A0/</link>
        <pubDate>Tue, 11 Dec 2018 10:50:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/socket-io%E5%AD%A6%E4%B9%A0/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;å¾ˆæ€¥ï¼Œæš‚æ—¶ä¸å†™äº†&lt;/p&gt;
&lt;h2 id=&#34;æ ¸å¿ƒç‚¹&#34;&gt;æ ¸å¿ƒç‚¹
&lt;/h2&gt;&lt;p&gt;ä¸ç®¡æ˜¯æœåŠ¡å™¨è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½æœ‰ emit å’Œ on è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œå¯ä»¥è¯´ socket.io çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸¤ä¸ªå‡½æ•°äº†ï¼Œé€šè¿‡ emit å’Œ on å¯ä»¥è½»æ¾åœ°å®ç°æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„åŒå‘é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;emit ï¼šç”¨æ¥å‘å°„ä¸€ä¸ªäº‹ä»¶æˆ–è€…è¯´è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºäº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦å‘é€çš„æ•°æ®ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼ˆä¸€èˆ¬çœç•¥ï¼Œå¦‚éœ€å¯¹æ–¹æ¥å—åˆ°ä¿¡æ¯åç«‹å³å¾—åˆ°ç¡®è®¤æ—¶ï¼Œåˆ™éœ€è¦ç”¨åˆ°å›è°ƒå‡½æ•°ï¼‰ã€‚
on ï¼šç”¨æ¥ç›‘å¬ä¸€ä¸ª emit å‘å°„çš„äº‹ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦ç›‘å¬çš„äº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ç”¨æ¥æ¥æ”¶å¯¹æ–¹å‘æ¥çš„æ•°æ®ï¼Œè¯¥åŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¥æ”¶çš„æ•°æ®ï¼Œè‹¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™ä¸ºè¦è¿”å›çš„å‡½æ•°ã€‚
socket.io æä¾›äº†ä¸‰ç§é»˜è®¤çš„äº‹ä»¶ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æœ‰ï¼‰ï¼šconnect ã€message ã€disconnect ã€‚å½“ä¸å¯¹æ–¹å»ºç«‹è¿æ¥åè‡ªåŠ¨è§¦å‘ connect äº‹ä»¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹å‘æ¥çš„æ•°æ®åè§¦å‘ message äº‹ä»¶ï¼ˆé€šå¸¸ä¸º socket.send() è§¦å‘ï¼‰ï¼Œå½“å¯¹æ–¹å…³é—­è¿æ¥åè§¦å‘ disconnect äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æœåŠ¡å™¨ç«¯åŒºåˆ†ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;p&gt;socket.emit() ï¼šå‘å»ºç«‹è¯¥è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­
socket.broadcast.emit() ï¼šå‘é™¤å»å»ºç«‹è¯¥è¿æ¥çš„å®¢æˆ·ç«¯çš„æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­
io.sockets.emit() ï¼šå‘æ‰€æœ‰å®¢æˆ·ç«¯å¹¿æ’­ï¼Œç­‰åŒäºä¸Šé¢ä¸¤ä¸ªçš„å’Œ&lt;/p&gt;
</description>
        </item>
        <item>
        <title>åˆæ³•å•çº¿åŒæ‹¨â€”â€”æé«˜å¯å®¤è·¯ç”±å¸¦å®½åˆ©ç”¨ç‡</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E5%90%88%E6%B3%95%E5%8D%95%E7%BA%BF%E5%8F%8C%E6%8B%A8%E6%8F%90%E9%AB%98%E5%AF%9D%E5%AE%A4%E8%B7%AF%E7%94%B1%E5%B8%A6%E5%AE%BD%E5%88%A9%E7%94%A8%E7%8E%87/</link>
        <pubDate>Sat, 10 Nov 2018 18:08:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E5%90%88%E6%B3%95%E5%8D%95%E7%BA%BF%E5%8F%8C%E6%8B%A8%E6%8F%90%E9%AB%98%E5%AF%9D%E5%AE%A4%E8%B7%AF%E7%94%B1%E5%B8%A6%E5%AE%BD%E5%88%A9%E7%94%A8%E7%8E%87/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;æœ¬äººå¯å®¤æœ‰ä¸¤ä¸ªç§»åŠ¨å®½å¸¦ï¼Œä½¿ç”¨å…‰çº¤å…¥æˆ·æ–¹å¼ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯20Mï¼Œå¦ä¸€ä¸ªæ˜¯30Mï¼Œä½¿ç”¨pppoeæ–¹å¼æ‹¨å·ä¸Šç½‘ã€‚å¸Œæœ›èƒ½å¤Ÿå°†ä¸¤ä¸ªå¸¦å®½è¿›è¡Œåˆå¹¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆä¸€&#34;&gt;æ–¹æ¡ˆä¸€
&lt;/h2&gt;&lt;p&gt;åœ¨äº¬ä¸œä¸Šæœç´¢å¤šwanå£è·¯ç”±ï¼Œä»·æ ¼æ¯”è¾ƒè´µã€‚passã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ–¹æ¡ˆäºŒ&#34;&gt;æ–¹æ¡ˆäºŒ
&lt;/h2&gt;&lt;p&gt;å°†æ‰‹ä¸Šçš„å°ç±³è·¯ç”±å™¨miniè¿›è¡Œæ”¹é€ ã€‚åˆ·å…¥OpenWrtã€‚&lt;/p&gt;
&lt;h2 id=&#34;åˆ·å…¥openwrt&#34;&gt;åˆ·å…¥OpenWrt
&lt;/h2&gt;&lt;p&gt;ä¸æ˜¯æœ¬ç¯‡å¾—é‡ç‚¹ã€‚ä½†æ˜¯æœ‰ä¸€ç‚¹ï¼ŒOpenWrtçš„å›ºä»¶å¯ä»¥åœ¨å®˜æ–¹ç½‘ç«™æŸ¥è¯¢åˆ°å¹¶ä¸‹è½½ï¼Œå…¶æºä¹Ÿé½å…¨å¹¶æ–°æ½®ï¼Œä¸éœ€è¦åˆ·å…¥æ—§çš„Pandoraboxç­‰æºä¸å¯é å¾—å›ºä»¶ã€‚è·¯ç”±éœ€è¦åˆ·å…¥å¼€å‘ç‰ˆå›ºä»¶å’Œsshå›ºä»¶ï¼Œç„¶åé€šè¿‡å‘½ä»¤è¡Œåˆ·å…¥OpenWrtå›ºä»¶ã€‚ä¸éœ€è¦åˆ·å…¥breedçš„u-bootï¼Œè¿™ç§è¡Œä¸ºå¤ªå±é™©äº†ï¼Œè¿˜ä¼šä¸¢å¤±SNã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€æ¬¡æ‹¨å·è®¾ç½®å›½å†…æº&#34;&gt;ç¬¬ä¸€æ¬¡æ‹¨å·ï¼Œè®¾ç½®å›½å†…æº
&lt;/h2&gt;&lt;p&gt;é¦–å…ˆå¼€å¯è·¯ç”±å™¨ï¼Œæ’ä¸Šç½‘çº¿ï¼Œè®¿é—®192.168.1.1ï¼Œåœ¨é¡µé¢ä¸­è®¾ç½®rootå¯†ç ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨system softwareé¡µé¢ä¸­ï¼Œç‚¹å‡»configurationï¼Œå°†downloads.openwrt.orgè¿›è¡Œæ›¿æ¢ï¼Œæ¢æˆopenwrt.proxy.ustclug.orgï¼Œå¹¶æäº¤ã€‚åœ¨network - interfaceé¡µé¢ç¼–è¾‘ wané…ç½®ï¼Œæ›´æ”¹åè®®å¹¶é…ç½®pppoeä¸Šç½‘ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨sshè¿æ¥è·¯ç”±å™¨ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥opkg updateã€‚æ³¨æ„æœ‰æ²¡æœ‰æˆåŠŸã€‚
ç„¶åè¾“å…¥opkg install kmod-macvlan mwan3 luci-app-mwan3ã€‚æ²¡æˆåŠŸå¤šè¯•å‡ æ¬¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¾ç½®è™šæ‹Ÿç½‘å¡&#34;&gt;è®¾ç½®è™šæ‹Ÿç½‘å¡
&lt;/h2&gt;&lt;p&gt;åœ¨interfaceä¸­æŸ¥çœ‹wançš„interfaceç»‘å®šçš„vlanï¼Œæ˜¯eth0.2ã€‚åœ¨ç»ˆç«¯è¾“å…¥ ip link add link eth0.2 name veth0 type macvlanï¼Œå¹¶è¾“å…¥ifconfig veth0 upã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»‘å®šç½‘å¡åˆ°æ¥å£&#34;&gt;ç»‘å®šç½‘å¡åˆ°æ¥å£
&lt;/h2&gt;&lt;p&gt;æ–¹ä¾¿èµ·è§ï¼Œä¿®æ”¹WAN6ä½œä¸ºæˆ‘ä»¬çš„ç¬¬äºŒä¸ªæ¥å£ï¼Œè®¾ç½®ç¬¬äºŒä¸ªè´¦å·å¾—pppoeçš„ä¸Šç½‘è´¦å·ï¼Œç„¶åä¿®æ”¹å…¶physical settingä¸ºveth0ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ­¤æ—¶ä¸¤ä¸ªè´¦æˆ·æ— æ³•åŒæ—¶æ‹¨å·ï¼Œè¯´æ˜ä¸æ”¯æŒå•çº¿åŒæ‹¨ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®¾ç½®è·ƒç‚¹æ•°&#34;&gt;è®¾ç½®è·ƒç‚¹æ•°
&lt;/h2&gt;&lt;p&gt;åœ¨wanå’Œwan6ä¸¤ä¸ªé¡µé¢ä¸­è®¾ç½®use gateway metricï¼Œæ³¨æ„è¦ä¸ä¸€æ ·ã€‚ä¾‹å¦‚ä¸€ä¸ª10ä¸€ä¸ª11.&lt;/p&gt;
&lt;h2 id=&#34;è®¾ç½®è´Ÿè½½å‡è¡¡&#34;&gt;è®¾ç½®è´Ÿè½½å‡è¡¡
&lt;/h2&gt;&lt;p&gt;åœ¨load balanceä¾æ¬¡è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-4ab82e3c830e21eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-4d33889aa0f50ac4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-b2c855543979f90d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-663f2ac3b0c03f9a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-1471b0c103f8d280.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-9700345d9f5cc1b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;é‡å¯æœåŠ¡&#34;&gt;é‡å¯æœåŠ¡
&lt;/h2&gt;&lt;p&gt;ç‚¹å‡»é‡å¯æœåŠ¡&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-4c7cf9d8e39f4654.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•
&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-85863aecfb262d0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒ &lt;a class=&#34;link&#34; href=&#34;https://acris.me/2017/06/25/Load-balancing-multiple-PPPoE-on-LEDE/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://acris.me/2017/06/25/Load-balancing-multiple-PPPoE-on-LEDE/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        </item>
        <item>
        <title>ä½¿ç”¨Let&#39;s encryptå’Œnginxé…ç½®httpsè®¿é—®</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E4%BD%BF%E7%94%A8lets-encrypt%E5%92%8Cnginx%E9%85%8D%E7%BD%AEhttps%E8%AE%BF%E9%97%AE/</link>
        <pubDate>Mon, 04 Jun 2018 09:12:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E4%BD%BF%E7%94%A8lets-encrypt%E5%92%8Cnginx%E9%85%8D%E7%BD%AEhttps%E8%AE%BF%E9%97%AE/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;ä¸ºäº†åŠ å¯†ä¼ è¾“httpçš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°httpsè¯ä¹¦ã€‚å…è´¹çš„è¯ä¹¦æœ‰letsâ€˜s encryptã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨nginxé…ç½®è½¬å‘&#34;&gt;ä½¿ç”¨nginxé…ç½®è½¬å‘
&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šé…ç½®nginxï¼Œä½¿å¾—lets&amp;rsquo;s encryptèƒ½å¤ŸéªŒè¯æˆ‘ä»¬çš„åŸŸåã€‚
ä¸‹é¢æ˜¯æˆ‘çš„æœåŠ¡å™¨nginxçš„é…ç½®æ–‡ä»¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;listen&lt;/span&gt;       &lt;span style=&#34;color:#ae81ff&#34;&gt;80&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;server_name&lt;/span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;www.unrealblue.cc&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;301&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;https://&lt;/span&gt;$host$request_uri;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;location&lt;/span&gt; ~ &lt;span style=&#34;color:#e6db74&#34;&gt;/.well-known/acme-challenge&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/var/www/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;allow&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;all&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯´æ˜ï¼šç¬¬ä¸€ä¸ªlocationæ„æ€æ˜¯è½¬å‘æ‰€æœ‰çš„80è¯·æ±‚åˆ°httpsè¿æ¥ã€‚ç¬¬äºŒä¸ªè¯·æ±‚çš„æ„æ€æ˜¯ï¼Œå¦‚æœè®¿é—®.well-knownï¼Œåˆ™ä½¿ç”¨æˆ‘ä»¬æä¾›çš„/var/www/htmlç›®å½•ã€‚&lt;/p&gt;
&lt;p&gt;å°†æ–‡ä»¶ä¿å­˜ä¸ºdefault.confã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæˆ‘ä½¿ç”¨äº†nginx dockeræ¥éƒ¨ç½²ï¼Œæ‰€ä»¥æ²¡æœ‰å®‰è£…nginxã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-docker&#34; data-lang=&#34;docker&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; nginx&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;LABEL&lt;/span&gt; MAINTAINER linanwx@gmail.com&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; apt update&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; apt install -y certbot&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; mkdir -p /var/www/html&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; ./default.conf /etc/nginx/conf.d/&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPOSE&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; 80:80&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPOSE&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; 443:443&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;VOLUME&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/etc/letsencrypt/&amp;#34;&lt;/span&gt;]&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ç¬¬ä¸€ä¸ªä»£ç æ®µå­˜ä¸ºdefault.confï¼Œç¬¬äºŒä¸ªä»£ç æ®µå­˜ä¸ºdockerfileï¼Œç„¶åè¿è¡Œ&lt;code&gt;docker build -t nginx-server .&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œ&lt;code&gt;docker run -it --rm -d -p80:80 -p443:443 --net=server-net --name nginx-server -v $PWD/letsencrypt:/etc/letsencrypt nginx-server&lt;/code&gt;å¯åŠ¨å®¹å™¨å¹¶åœ¨åå°è¿è¡Œã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç”Ÿæˆè¯ä¹¦&#34;&gt;ç”Ÿæˆè¯ä¹¦
&lt;/h2&gt;&lt;p&gt;è¿è¡Œ&lt;code&gt;docker exec -it nginx-server /bin/bash&lt;/code&gt;è¿›å…¥å®¹å™¨å†…éƒ¨ã€‚
è¿è¡Œä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆè¯ä¹¦&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;openssl dhparam -out /etc/letsencrypt/live/dhparams.pem 2048
certbot certonly --agree-tos -a webroot --webroot-path=/var/www/html -d www.unrealblue.cc -m linanwx@gmail.com
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;certbotç¨‹åºä¼šè®¿é—®ä½ çš„åŸŸåï¼Œæ¥ç¡®è®¤ä½ çš„åŸŸåæ‰€æœ‰æƒæ˜¯ä½ ï¼Œè¿™å°±ç”¨åˆ°äº†ä¸Šä¸€æ­¥æ“ä½œçš„nginxçš„é…ç½®ã€‚å…¶ä¸­è¿˜æœ‰ä¸€äº›å‚æ•°ï¼ŒæŸ¥çœ‹helpå¯ä»¥çŸ¥é“å«ä¹‰ã€‚å¦å¤–ï¼Œé™¤éä½ ç¡®è®¤è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œå¦åˆ™åœ¨æµ‹è¯•é˜¶æ®µä½¿ç”¨&amp;ndash;test-certå‚æ•°æ¥è¿›è¡Œæµ‹è¯•ã€‚å› ä¸ºè¯ä¹¦ç”Ÿæˆæ˜¯æœ‰æ•°é‡é™åˆ¶çš„ã€‚
å¦å¤–ä¸€ç‚¹å°±æ˜¯ç”Ÿæˆdhparamã€‚ä»–æ˜¯è¿ªè²-èµ«å°”æ›¼ç§˜é’¥äº¤æ¢åè®®å‚æ•°ï¼Œç”Ÿæˆæ—¶é—´è¾ƒé•¿ã€‚ä¹‹åæˆ‘ä»¬ä¼šåœ¨nginxä¸­ä½¿ç”¨è¿™ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;ä¸å‡ºæ„å¤–ä½ ä¼šè·å¾—è¯ä¹¦ï¼Œä»–ä»¬å­˜åœ¨/etc/letsencrypt/ç›®å½•ä¸‹ã€‚å¹¶ä¸”ï¼Œç”±äºåœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™ä½¿ç”¨äº†æŒ‚å·ï¼Œè¯ä¹¦ä¼šå‡ºç°åœ¨å®¿ä¸»æœºä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é…ç½®nginx-https&#34;&gt;é…ç½®nginx https
&lt;/h2&gt;&lt;p&gt;æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸ºhttp.conf&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-nginx&#34; data-lang=&#34;nginx&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# https://www.jianshu.com/p/f7f39cb24423
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;server&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;listen&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;443&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;ssl&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;server_name&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;www.unrealblue.cc&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_certificate&lt;/span&gt;                 &lt;span style=&#34;color:#e6db74&#34;&gt;/etc/letsencrypt/live/www.unrealblue.cc/fullchain.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_trusted_certificate&lt;/span&gt;         &lt;span style=&#34;color:#e6db74&#34;&gt;/etc/letsencrypt/live/www.unrealblue.cc/fullchain.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_certificate_key&lt;/span&gt;             &lt;span style=&#34;color:#e6db74&#34;&gt;/etc/letsencrypt/live/www.unrealblue.cc/privkey.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_dhparam&lt;/span&gt;                     &lt;span style=&#34;color:#e6db74&#34;&gt;/etc/letsencrypt/live/dhparams.pem&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_ciphers&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_prefer_server_ciphers&lt;/span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_protocols&lt;/span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;TLSv1&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;TLSv1.1&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;TLSv1.2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_session_cache&lt;/span&gt;          &lt;span style=&#34;color:#e6db74&#34;&gt;shared:SSL:50m&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_session_timeout&lt;/span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;1d&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_stapling&lt;/span&gt;               &lt;span style=&#34;color:#66d9ef&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;ssl_stapling_verify&lt;/span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;on&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;add_header&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;Strict-Transport-Security&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;max-age=60&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;location&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;/&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;root&lt;/span&gt;   &lt;span style=&#34;color:#e6db74&#34;&gt;/usr/share/nginx/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;index&lt;/span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;index.html&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;index.htm&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# location = /gfwlist {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;#     proxy_pass http://server-handy:8081;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;# }
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;error_page&lt;/span&gt;   &lt;span style=&#34;color:#ae81ff&#34;&gt;500&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;502&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;503&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;504&lt;/span&gt;  &lt;span style=&#34;color:#e6db74&#34;&gt;/50x.html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;location&lt;/span&gt; = &lt;span style=&#34;color:#e6db74&#34;&gt;/50x.html&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;root&lt;/span&gt;   &lt;span style=&#34;color:#e6db74&#34;&gt;/usr/share/nginx/html&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†å…¶ä¿å­˜ã€‚ç„¶åä¿®æ”¹dockerfileå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-dockerfile&#34; data-lang=&#34;dockerfile&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; nginx&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;LABEL&lt;/span&gt; MAINTAINER linanwx@gmail.com&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; apt update&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; apt install -y certbot&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;RUN&lt;/span&gt; mkdir -p /var/www/html&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; ./default.conf /etc/nginx/conf.d/&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;COPY&lt;/span&gt; ./https.conf /etc/nginx/conf.d/&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPOSE&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; 80:80&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;EXPOSE&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt; 443:443&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;VOLUME&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;/etc/letsencrypt/&amp;#34;&lt;/span&gt;]&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œå°†è¿™ä¸ªhttp.confä¹Ÿä¸€åŒå¤åˆ¶è¿›å»äº†ã€‚&lt;/p&gt;
&lt;p&gt;é‡æ–°å¯åŠ¨å®¹å™¨ï¼Œè®¿é—®https://127.0.0.1ï¼Œå¯ä»¥çœ‹åˆ°è®¿é—®æˆåŠŸäº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-edc2003618e67290.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬åœ°ç¯å¢ƒæµ‹è¯•çš„æ—¶å€™ä¼šæç¤ºè¯ä¹¦ä¸æ­£ç¡®ã€‚
ç‚¹ç»§ç»­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-f155d050593dadf4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
</description>
        </item>
        <item>
        <title>socatå‘½ä»¤å­¦ä¹ </title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/socat%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/</link>
        <pubDate>Wed, 23 May 2018 09:04:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/socat%E5%91%BD%E4%BB%A4%E5%AD%A6%E4%B9%A0/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;socatæ˜¯å¼ºå¤§æ˜“ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å®ç°ä»»æ„socketçš„è½¬æ¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨&#34;&gt;ä½¿ç”¨
&lt;/h2&gt;&lt;p&gt;&lt;code&gt;socat [options] &amp;lt;address&amp;gt; &amp;lt;address&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;optionså¯ä»¥æŸ¥çœ‹helpã€‚&lt;/p&gt;
&lt;p&gt;addressæœ‰ä¸€ä¸‹å‡ ç§å½¢å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;-&lt;/code&gt; &lt;code&gt;STDIN&lt;/code&gt; &lt;code&gt;STDOUT&lt;/code&gt; ï¼šè¡¨ç¤ºæ ‡å‡†è¾“å…¥è¾“å‡ºï¼Œå¯ä»¥å°±ç”¨ä¸€ä¸ªæ¨ªæ ä»£æ›¿&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/var/log/syslog&lt;/code&gt; : ä¹Ÿå¯ä»¥æ˜¯ä»»æ„è·¯å¾„ï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„è¦ä½¿ç”¨./ï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä½œä¸ºæ•°æ®æµã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TCP:127.0.0.1:1080&lt;/code&gt; : å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ä½œä¸ºæ•°æ®æµï¼ŒTCPä¹Ÿå¯ä»¥æ›¿æ¢ä¸ºUDP&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TCP-LISTEN:12345&lt;/code&gt; : å»ºç«‹TCPç›‘å¬ç«¯å£ï¼ŒTCPä¹Ÿå¯ä»¥æ›¿æ¢ä¸ºUDP&lt;/li&gt;
&lt;li&gt;&lt;code&gt;EXEC:/bin/bash&lt;/code&gt; : æ‰§è¡Œä¸€ä¸ªç¨‹åºä½œä¸ºæ•°æ®æµã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;åœºæ™¯ä¸€&#34;&gt;åœºæ™¯ä¸€
&lt;/h2&gt;&lt;p&gt;æœ¬åœ°æœ‰ä¸ªæ–‡ä»¶ï¼Œæˆ‘æƒ³æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸­&lt;/p&gt;
&lt;p&gt;&lt;code&gt;socat - /etc/sysctl.conf&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;åœºæ™¯äºŒ&#34;&gt;åœºæ™¯äºŒ
&lt;/h2&gt;&lt;p&gt;æœ‰ä¸ªTCPè¿æ¥ä¼šè¿ä¸Šæ¥ï¼Œæˆ‘æƒ³çœ‹çœ‹ä¼šè·å¾—ä»€ä¹ˆæ•°æ®ã€‚
&lt;code&gt;socat TCP-LISTEN:12345 -&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;åœºæ™¯ä¸‰&#34;&gt;åœºæ™¯ä¸‰
&lt;/h2&gt;&lt;p&gt;æˆ‘æ˜¯é»‘å®¢ï¼Œæˆ‘æƒ³åœ¨ç›®æ ‡æœºä¸Šå¼„ä¸€ä¸ªshellä»£ç†
&lt;code&gt;socat TCP-LISTEN:12345 EXEC:/bin/bash&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;åœºæ™¯å››&#34;&gt;åœºæ™¯å››
&lt;/h2&gt;&lt;p&gt;æœ¬åœ°æœ‰ä¸€ä¸ªUNIX DOMAINåŸŸå¥—æ¥å­—ï¼Œæˆ‘æƒ³æŠŠä»–è½¬æˆTCP SOCKETä¾›å±€åŸŸç½‘å†…çš„æœºå™¨ä½¿ç”¨ï¼Œæ€ä¹ˆåŠï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;code&gt;socat TCP-LISTEN:12345,reuseaddr,fork UNIX-CONNECT:/data/deCOREIDPS/unix.domain&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å½“æœ‰å¤šä¸ªtcpè¿ä¸Šæ¥é‚£å°±forkä¸€ä¸ªå»è¿åŸŸå¥—æ¥å­—&lt;/p&gt;
&lt;h2 id=&#34;åœºæ™¯äº”&#34;&gt;åœºæ™¯äº”
&lt;/h2&gt;&lt;p&gt;å°†æœ¬åœ°çš„80ç«¯å£è½¬åˆ°è¿œç¨‹å»&lt;/p&gt;
&lt;p&gt;&lt;code&gt;socat TCP-LISTEN:80,fork TCP:www.baidu.com:80&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å‚è€ƒ &lt;a class=&#34;link&#34; href=&#34;http://brieflyx.me/2015/linux-tools/socat-introduction/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://brieflyx.me/2015/linux-tools/socat-introduction/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        </item>
        <item>
        <title>epollä»£ç ç¤ºä¾‹â€”â€”handyåº“è‡ªå¸¦epoll.ccåˆ†æ</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/epoll%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8Bhandy%E5%BA%93%E8%87%AA%E5%B8%A6epoll-cc%E5%88%86%E6%9E%90/</link>
        <pubDate>Wed, 16 May 2018 07:43:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/epoll%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8Bhandy%E5%BA%93%E8%87%AA%E5%B8%A6epoll-cc%E5%88%86%E6%9E%90/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;C++ç½‘ç»œåº“æœ‰å¾ˆå¤šã€‚handyæ˜¯ä¸€ä¸ªC++11é£æ ¼çš„ç½‘ç»œåº“ï¼Œå¯¹æ·±å…¥å­¦ä¹ C++æœ‰å¾ˆå¤§å¸®åŠ©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»£ç åˆ†æ&#34;&gt;ä»£ç åˆ†æ
&lt;/h2&gt;&lt;p&gt;ä¸‹é¢æ˜¯æ¥è‡ªhandy/raw_examplesä¸‹çš„epoll.ccæ–‡ä»¶ã€‚æ˜¯æ°´å¹³è§¦å‘çš„ä¸€ä¸ªç¤ºä¾‹ã€‚è¯¥httpæœåŠ¡å™¨æ— è®ºæ¥æ”¶åˆ°ä»€ä¹ˆæ ·çš„è¯·æ±‚ï¼Œéƒ½è¿”å›ä¸€ä¸ªé™æ€èµ„æº123456ã€‚ç¼–è¯‘ï¼šc++ -o epoll epoll.ccï¼Œè¿è¡Œï¼š sudo ./epollã€‚æºä»£ç ä¸­sendResçš„if (con.writeEnabled)è¿™å¥ä¼¼ä¹æœ‰äº›é—®é¢˜ï¼Œå¯¼è‡´å‘é€è¶…å¤§èµ„æºæ—¶å‡ºç°é—®é¢˜ã€‚æˆ‘å·²ç»åšäº†ä¿®æ”¹ï¼Œä½¿ä¹‹èƒ½å¤Ÿæ­£ç¡®å‘é€è¶…å¤§æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;/*
 * ç¼–è¯‘ï¼šc++ -o epoll epoll.cc
 * è¿è¡Œï¼š ./epoll
 * æµ‹è¯•ï¼šcurl -v localhost
 */


/* 
    è¿è¡Œæ•ˆæœ
    ä½¿ç”¨sudo è¿è¡Œepollç¨‹åºã€‚è¯¥ç¨‹åºåœ¨æœ¬æœº0.0.0.0çš„80ç«¯å£ç›‘å¬ï¼Œä½œä¸ºä¸€ä¸ªhttpæœåŠ¡å™¨è¿è¡Œ
    æ¯å½“æœ‰è¿æ¥è®¿é—®æ—¶ï¼Œè¿”å›é™æ€èµ„æºhttpRes
    LTæ˜¯é»˜è®¤æ¨¡å¼

 */

#include &amp;lt;sys/socket.h&amp;gt;
#include &amp;lt;sys/epoll.h&amp;gt;
#include &amp;lt;netinet/in.h&amp;gt;
#include &amp;lt;arpa/inet.h&amp;gt;
#include &amp;lt;fcntl.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;errno.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;map&amp;gt;
#include &amp;lt;string&amp;gt;
#include &amp;lt;signal.h&amp;gt;
#include &amp;lt;iostream&amp;gt;
using namespace std;


bool output_log = true;
// ä¸€ä¸ªå®ï¼Œç”¨æ¥æ‰“å°é”™è¯¯å¹¶é€€å‡º
#define exit_if(r, ...) if(r) {printf(__VA_ARGS__); printf(&amp;#34;%s:%d error no: %d error msg %s\n&amp;#34;, __FILE__, __LINE__, errno, strerror(errno)); exit(1);}
// è¿™ä¸ªå‡½æ•°ç”¨äºå°†æŒ‡å®šçš„fdè®¾ç½®ä¸ºéé˜»å¡çŠ¶æ€
void setNonBlock(int fd) {
    // é¦–å…ˆæˆ‘ä»¬å–å‡ºåŸæ¥æ–‡ä»¶æè¿°ç¬¦çš„flags
    int flags = fcntl(fd, F_GETFL, 0);
    exit_if(flags&amp;lt;0, &amp;#34;fcntl failed&amp;#34;);
    // ç„¶ååŠ ä¸ŠO_NONBLOCKï¼Œå†è®¾ç½®å›å»
    int r = fcntl(fd, F_SETFL, flags | O_NONBLOCK);
    exit_if(r&amp;lt;0, &amp;#34;fcntl failed&amp;#34;);
}
// å¯¹epoll_ctläºŒæ¬¡åŒ…è£…ï¼Œå°†events å’Œ fdæ”¾å…¥evä¸­ã€‚
// å¹¶ä¸”è®¾ç½®events è®¾ç½®ä¸ºå¯è¯»å¯å†™æ—¶è§¦å‘
void updateEvents(int efd, int fd, int events, int op) {
    struct epoll_event ev = {0};
    ev.events = events;
    ev.data.fd = fd;
    printf(&amp;#34;%s fd %d events read %d write %d\n&amp;#34;,
           op==EPOLL_CTL_MOD?&amp;#34;mod&amp;#34;:&amp;#34;add&amp;#34;, fd, ev.events &amp;amp; EPOLLIN, ev.events &amp;amp; EPOLLOUT);
    int r = epoll_ctl(efd, op, fd, &amp;amp;ev);
    exit_if(r, &amp;#34;epoll_ctl failed&amp;#34;);
}
// å°è¯•åœ¨fdä¸Šåšacceptæ“ä½œã€‚å¦‚æœæˆåŠŸï¼Œå°†å…¶åŠ å…¥åˆ°epoll fdçš„ç›‘å¬åˆ—è¡¨ä¸­ã€‚epollçš„eventsè®¾ç½®ä¸ºå½“æ•°æ®æœ‰å†™å…¥çš„æ—¶å€™è§¦å‘ã€‚
void handleAccept(int efd, int fd) {
    struct sockaddr_in raddr;
    socklen_t rsz = sizeof(raddr);
    int cfd = accept(fd,(struct sockaddr *)&amp;amp;raddr,&amp;amp;rsz);
    exit_if(cfd&amp;lt;0, &amp;#34;accept failed&amp;#34;);
    sockaddr_in peer, local;
    socklen_t alen = sizeof(peer);
    int r = getpeername(cfd, (sockaddr*)&amp;amp;peer, &amp;amp;alen);
    exit_if(r&amp;lt;0, &amp;#34;getpeername failed&amp;#34;);
    printf(&amp;#34;accept a connection from %s\n&amp;#34;, inet_ntoa(raddr.sin_addr));
    setNonBlock(cfd);
    updateEvents(efd, cfd, EPOLLIN, EPOLL_CTL_ADD);
}
// è¡¨ç¤ºä¸€ä¸ªè¿æ¥ã€‚æˆå‘˜æœ‰è¿æ¥å·²è¯»å–çš„æ•°æ®ã€å·²å†™å…¥çš„æ•°æ®
// stringç”¨æ¥ä¿å­˜äºŒè¿›åˆ¶å†…å®¹æ²¡æœ‰é—®é¢˜å—ï¼Œå¦‚æœé‡åˆ°\0ä¼šå¦‚ä½•ï¼Ÿ
// æ²¡æœ‰é—®é¢˜https://www.zhihu.com/question/33104941
struct Con {
    string readed;
    size_t written;
    bool writeEnabled;
    Con(): written(0), writeEnabled(false) {}
};
// ç”¨æ¥æ˜ å°„fdä¸conçš„æ•°æ®ç»“æ„
map&amp;lt;int, Con&amp;gt; cons;

string httpRes;
// å‘é€èµ„æº
void sendRes(int efd, int fd) {
    // é¦–å…ˆå–å¾—è¿æ¥ä¿¡æ¯
    Con&amp;amp; con = cons[fd];
    // æ²¡æœ‰æ¥å—åˆ°æ•°æ®å°±è¦æ±‚å†™å…¥
    // è¯´æ˜å…¶å¯èƒ½ä¸Šä¸€æ¬¡ç»§ç»­å‘é€çš„æ•°æ®å‘é€å®Œäº†
    // å…¶å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦åœ¨consä¸­å·²ç»åˆ é™¤
    // ç„¶åè§¦å‘äº†epollä¿¡å·
    // æ­¤æ—¶å…³é—­å…¶ä¸Šä¸€æ¬¡å‘é€çš„æ ‡å¿—
    // ç„¶åå…³é—­å…¶ç¼“å†²åŒºå‘é€è§¦å‘epollçš„æ ‡å¿—
    // åªä¿ç•™å…¶æœ‰æ•°æ®å¯è¯»æ—¶è§¦å‘
    // ä¸ºä»€ä¹ˆä¸åœ¨å†™å…¥å®Œæ•°æ®æ—¶å°±å°†è¿™æ­¥åšäº†å‘¢ï¼Ÿ
    // if (!con.readed.length()) {
    //     if (con.writeEnabled) {
    //         updateEvents(efd, fd, EPOLLIN, EPOLL_CTL_MOD);
    //         con.writeEnabled = false;
    //     }
    //     return;
    // }
    // è®¡ç®—è¿˜éœ€è¦å†™å…¥çš„æ•°æ®é•¿åº¦
    size_t left = httpRes.length() - con.written;
    int wd = 0;
    // è¿ç»­å†™å…¥æ•°æ®ï¼Œç›´åˆ°å†…æ ¸ç¼“å†²åŒºæ— æ³•å†™å…¥æ•°æ®ä¸ºæ­¢
    while((wd=::write(fd, httpRes.data()+con.written, left))&amp;gt;0) {
        con.written += wd;
        left -= wd;
        if(output_log) printf(&amp;#34;write %d bytes left: %lu\n&amp;#34;, wd, left);
    };
    // å¦‚æœæ²¡æœ‰æ•°æ®å¯ä»¥å†™å…¥ï¼Œåˆ™åˆ é™¤è¿™ä¸ªè¿æ¥ã€‚ä½†æ˜¯ä¸æ–­å¼€è¿æ¥ï¼Œå³å°†è¿æ¥ä¿¡æ¯ç½®ç©º
    if (left == 0) {
//        close(fd); // æµ‹è¯•ä¸­ä½¿ç”¨äº†keepaliveï¼Œå› æ­¤ä¸å…³é—­è¿æ¥ã€‚è¿æ¥ä¼šåœ¨readäº‹ä»¶ä¸­å…³é—­
        if (con.writeEnabled) {
            updateEvents(efd, fd, EPOLLIN, EPOLL_CTL_MOD);
            con.writeEnabled = false;
        }
        cons.erase(fd);
        return;
    }
    // å¦‚æœå†…æ ¸ç¼“å†²åŒºæ»¡äº†ï¼Œæ²¡åŠæ³•å†™å…¥äº†
    if (wd &amp;lt; 0 &amp;amp;&amp;amp;  (errno == EAGAIN || errno == EWOULDBLOCK)) {
        // å°†å…¶æ ‡è®°ä¸Šå¯ç»§ç»­å†™
        if (!con.writeEnabled) {
            // ç­‰å¾…å…¶å¯ç»§ç»­å†™ï¼Œæˆ–å¯è¯»
            // é¿å…é‡å¤è¿›è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨con.writeEnabledæ ‡è®°ä½
            printf(&amp;#34;update it to EPOLLIN|EPOLLOUT\n&amp;#34;);
            updateEvents(efd, fd, EPOLLIN|EPOLLOUT, EPOLL_CTL_MOD);
            con.writeEnabled = true;
        }
        return;
    }
    // å¦‚æœæ˜¯å…¶ä»–æƒ…å†µï¼Œæ¯”å¦‚åœ¨æ²¡æœ‰å†™å®Œæ•°æ®æ—¶ç›´æ¥è¿”å›0ï¼Œæˆ–è€…æ˜¯è¿”å›äº†å…¶ä»–é”™è¯¯
    // åˆ™è¯´æ˜å‡ºé”™äº†
    if (wd&amp;lt;=0) {
        printf(&amp;#34;write error for %d: %d %s\n&amp;#34;, fd, errno, strerror(errno));
        close(fd);
        cons.erase(fd);
    }
}
// å½“loop onceå¤„ç†è¯»å–æ•°æ®æ—¶ï¼Œè°ƒç”¨è¯¥å‡½æ•°
void handleRead(int efd, int fd) {
    char buf[4096];
    int n = 0;
    // æ¯æ¬¡è¯»å–4kå­—èŠ‚ï¼Œå¾ªç¯è¯»å‡ºå½“å‰å†…æ ¸ä¸­å·²å­˜åœ¨çš„æ•°æ®ï¼ˆæœ‰å¯èƒ½åˆ†åŒ…å¯¼è‡´ä¿¡æ¯ä¸å®Œæ•´ï¼‰
    while ((n=::read(fd, buf, sizeof buf)) &amp;gt; 0) {
        if(output_log) printf(&amp;#34;read %d bytes\n&amp;#34;, n);
        // è¿™é‡Œé€šè¿‡ä¸€ä¸ªmapæ¥è·å–ä¹‹å‰fdå¯¹åº”çš„è¿æ¥ä¿¡æ¯ã€‚
        // å½“fdå¯¹åº”çš„ä¸‹æ ‡ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œåˆ™ä¼šè°ƒç”¨conçš„é»˜è®¤æ„é€ å‡½æ•°Con(): written(0), writeEnabled(false) {}
        string&amp;amp; readed = cons[fd].readed;
        // è°ƒç”¨stringç±»çš„appendæ–¹æ³•å°†æ•°æ®åŠ å…¥åˆ°è¿æ¥ä¿¡æ¯ä¸­
        // æ³¨æ„ä¸ºäº†ä¿è¯äºŒè¿›åˆ¶å®‰å…¨éœ€è¦ä¼ å…¥å‚æ•°n
        readed.append(buf, n);
        std::cout  &amp;lt;&amp;lt; &amp;#34;now info is&amp;#34; &amp;lt;&amp;lt; std::endl &amp;lt;&amp;lt; &amp;#34;---&amp;#34; &amp;lt;&amp;lt;  readed &amp;lt;&amp;lt; endl &amp;lt;&amp;lt; &amp;#34;---&amp;#34; &amp;lt;&amp;lt;  std::endl;
        // åˆ¤æ–­ä¸€ä¸ªhttpè¯·æ±‚å‘é€å®Œæ¯•ã€‚
        // ä¸åˆ¤æ–­httpè¯·æ±‚çš„å†…å®¹ï¼Œä¸€å¾‹å‘é€é™æ€èµ„æº
        if (readed.length()&amp;gt;4) {
            if (readed.substr(readed.length()-2, 2) == &amp;#34;\n\n&amp;#34; || readed.substr(readed.length()-4, 4) == &amp;#34;\r\n\r\n&amp;#34;) {
                //å½“è¯»å–åˆ°ä¸€ä¸ªå®Œæ•´çš„httpè¯·æ±‚ï¼Œæµ‹è¯•å‘é€å“åº”
                // TCPè¿æ¥å»ºç«‹èµ·æ¥ä¹‹åï¼Œå®¢æˆ·ç«¯å°±å¼€å§‹ä¼ è¾“é¦–éƒ¨ï¼Œç„¶åä»¥\r\n\r\næ¥æ ‡å¿—é¦–éƒ¨çš„ç»“æŸå’Œå®ä½“çš„å¼€å§‹ï¼ˆå½“ç„¶æ˜¯è¯·æ±‚é‡ŒåŒ…å«å®ä½“æ‰ä¼šæœ‰å®ä½“çš„å¼€å§‹ï¼‰ï¼Œ
                // æ¥ä¸‹æ¥å°±æ˜¯å®ä½“çš„ä¼ è¾“ï¼Œå½“å®ä½“ä¼ è¾“å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å°±å¼€å§‹æ¥æ”¶æ•°æ®ï¼ŒæœåŠ¡å™¨å°±çŸ¥é“ï¼Œè¿™æ¬¡è¯·æ±‚å°±å·²ç»ç»“æŸäº†ï¼Œ
                // é‚£ä¹ˆå®ä½“å°±æ˜¯\r\n\r\nåˆ°åœæ­¢æ¥æ”¶çš„é‚£ä¹ˆä¸€æ®µæ•°æ®ã€‚å¯¹åº”çš„ï¼Œå®¢æˆ·ç«¯æ¥æ”¶å“åº”çš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ã€‚
                // æ²¡æœ‰å®ä½“ï¼Œåˆ™\r\n\r\nå°±æ˜¯httpçš„ç»“æŸ
                // å¼€å§‹å†™å…¥æ•°æ®ã€‚æ³¨æ„æœ‰å¯èƒ½ä½¿ç¼“å†²åŒºå†™æ»¡ï¼Œè‹¥å†™æ»¡äº†åˆ™åœ¨ä¹‹åç»§ç»­å†™å…¥
                sendRes(efd, fd);
            }
        }
    }
    // readæ— æ³•è¯»å–çš„è¯ï¼Œå°±ä¼šè¿”å›-1ã€‚æ­¤æ—¶errnoï¼ˆerrnoæ˜¯å±äºçº¿ç¨‹çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰æ˜¯EAGAINä»£è¡¨æ²¡è¯»å®Œã€‚EWOULDBLOCKå’ŒEAGAINæ˜¯ä¸€æ ·çš„ã€‚
    // é‚£å°±è¿”å›ï¼Œç„¶åç­‰å¾…ä¸‹æ¬¡å†è¯»å–
    if (n&amp;lt;0 &amp;amp;&amp;amp; (errno == EAGAIN || errno == EWOULDBLOCK)){
        printf(&amp;#34;nothing to read from %d, return. \n&amp;#34;, fd);
        return;
    }
    //å®é™…åº”ç”¨ä¸­ï¼Œn&amp;lt;0åº”å½“æ£€æŸ¥å„ç±»é”™è¯¯ï¼Œå¦‚EINTR
    if (n &amp;lt; 0) {
        printf(&amp;#34;read %d error: %d %s\n&amp;#34;, fd, errno, strerror(errno));
    }
    // æ‰§è¡Œåˆ°è¿™é‡Œï¼Œnæ˜¯0ï¼Œè¡¨ç¤ºå¯¹ç«¯å…³é—­è¿æ¥ã€‚è¿™æ—¶æˆ‘ä»¬ä¹Ÿå…³é—­è¿æ¥
    printf(&amp;#34;%d close the connection\n&amp;#34;, fd);
    close(fd);
    cons.erase(fd);
}
// å½“loop onceç¼“å†²åŒºå¯å†™çš„æ—¶å€™ï¼Œç®€å•çš„å†™å…¥æˆ‘ä»¬å‡†å¤‡å¥½çš„é™æ€èµ„æº
void handleWrite(int efd, int fd) {
    sendRes(efd, fd);
}
// å¯¹ä¸€ä¸ªepollå¥æŸ„è¿›è¡Œå¾ªç¯ä¸­çš„ä¸€æ¬¡æ“ä½œ
// å…¶ä¸­læ˜¯LISTENçš„fd
void loop_once(int efd, int lfd, int waitms) {
    // æœ€å¤šè®©å†…æ ¸æ‹·è´20ä¸ªäº‹ä»¶å‡ºæ¥
    const int kMaxEvents = 20;
    struct epoll_event activeEvs[100];
    int n = epoll_wait(efd, activeEvs, kMaxEvents, waitms);
    // næ˜¯è¿”å›äº†å¤šå°‘ä¸ªäº‹ä»¶
    if(output_log) printf(&amp;#34;epoll_wait return %d\n&amp;#34;, n);
    for (int i = 0; i &amp;lt; n; i ++) {
        int fd = activeEvs[i].data.fd;
        int events = activeEvs[i].events;
        // EPOLLIN äº‹ä»¶æˆ–è€…æ˜¯ EPOLLERRäº‹ä»¶ã€‚EPOLLERRä¹Ÿä»£è¡¨ç®¡é“å†™å…¥ç»“æŸã€‚
        // å‚è§ï¼š http://man7.org/linux/man-pages/man2/epoll_ctl.2.html
        if (events &amp;amp; (EPOLLIN | EPOLLERR)) {
            // EPOLLINäº‹ä»¶åˆ™åªæœ‰å½“å¯¹ç«¯æœ‰æ•°æ®å†™å…¥æ—¶æ‰ä¼šè§¦å‘ï¼Œæ‰€ä»¥è§¦å‘ä¸€æ¬¡åéœ€è¦ä¸æ–­è¯»å–æ‰€æœ‰æ•°æ®ç›´åˆ°è¯»å®ŒEAGAINä¸ºæ­¢ã€‚å¦åˆ™å‰©ä¸‹çš„æ•°æ®åªæœ‰åœ¨ä¸‹æ¬¡å¯¹ç«¯æœ‰å†™å…¥æ—¶æ‰èƒ½ä¸€èµ·å–å‡ºæ¥äº†ã€‚
            // å½“å¯¹æ–¹å…³é—­è¿æ¥ï¼Œåˆ™æ˜¯EPOLLERRäº‹ä»¶
            if (fd == lfd) {
                printf(&amp;#34;this is accept\n&amp;#34;);
                handleAccept(efd, fd); 
            } else {
                printf(&amp;#34;this can read\n&amp;#34;);
                handleRead(efd, fd);
            }
        } else if (events &amp;amp; EPOLLOUT) {
            // è¿™é‡Œå¤„ç†æ–‡ä»¶æè¿°ç¬¦å¦‚æœå¯ä»¥å†™å…¥çš„äº‹ä»¶
            // EPOLLOUTäº‹ä»¶åªæœ‰åœ¨è¿æ¥æ—¶è§¦å‘ä¸€æ¬¡ï¼Œè¡¨ç¤ºå¯å†™
            // ä¹‹åè¡¨ç¤ºç¼“å†²åŒºçš„æ•°æ®å·²ç»é€å‡ºï¼Œå¯ä»¥ç»§ç»­å†™å…¥
            // è¯¦è§https://www.zhihu.com/question/22840801
            if(output_log) printf(&amp;#34;handling epollout\n&amp;#34;);
            handleWrite(efd, fd);
        } else {
            exit_if(1, &amp;#34;unknown event&amp;#34;);
        }
    }
}

int main(int argc, const char* argv[]) {
    if (argc &amp;gt; 1) { output_log = false; }
    /* 
å°çŸ¥è¯†
signalï¼ˆå‚æ•°1ï¼Œå‚æ•°2ï¼‰ï¼›
å‚æ•°1ï¼šæˆ‘ä»¬è¦è¿›è¡Œå¤„ç†çš„ä¿¡å·ã€‚ç³»ç»Ÿçš„ä¿¡å·æˆ‘ä»¬å¯ä»¥å†ç»ˆç«¯é”®å…¥ kill -læŸ¥çœ‹(å…±64ä¸ª)ã€‚å…¶å®è¿™äº›ä¿¡å·æ—¶ç³»ç»Ÿå®šä¹‰çš„å®ã€‚
å‚æ•°2ï¼šæˆ‘ä»¬å¤„ç†çš„æ–¹å¼ï¼ˆæ˜¯ç³»ç»Ÿé»˜è®¤è¿˜æ˜¯å¿½ç•¥è¿˜æ˜¯æ•è·ï¼‰ã€‚SIG_IGN: å¦‚æœfuncå‚æ•°è¢«è®¾ç½®ä¸ºSIG_IGNï¼Œè¯¥ä¿¡å·å°†è¢«å¿½ç•¥ã€‚
     */
    ::signal(SIGPIPE, SIG_IGN);
    // è®¾ç½®httpè¿”å›çš„å†…å®¹
    httpRes = &amp;#34;HTTP/1.1 200 OK\r\nConnection: Keep-Alive\r\nContent-Type: text/html; charset=UTF-8\r\nContent-Length: 19048576\r\n\r\n123456&amp;#34;;
    // å°†å‰©ä¸‹çš„å†…å®¹å¡«å……æˆ0ã€‚æœ€åcontentçš„é•¿åº¦æ˜¯å¤§çº¦1024*1024
    for(int i=0;i&amp;lt;19048570;i++) {
        httpRes+=&amp;#39;\0&amp;#39;;
    }
    // è®¾ç½®ç«¯å£ä¸º80ç«¯å£
    short port = 80;
    // åˆ›å»ºä¸€ä¸ªepollå¥æŸ„
    int epollfd = epoll_create(1);
    exit_if(epollfd &amp;lt; 0, &amp;#34;epoll_create failed&amp;#34;);
    // åˆ›å»ºä¸€ä¸ªsocketå¥—æ¥å­—
    int listenfd = socket(AF_INET, SOCK_STREAM, 0);
    exit_if(listenfd &amp;lt; 0, &amp;#34;socket failed&amp;#34;);
    struct sockaddr_in addr;
    memset(&amp;amp;addr, 0, sizeof addr);
    addr.sin_family = AF_INET;
    addr.sin_port = htons(port);
    addr.sin_addr.s_addr = INADDR_ANY;
    // å…ˆç»‘å®šsocketåˆ°ç«¯å£ä¸Š
    int r = ::bind(listenfd,(struct sockaddr *)&amp;amp;addr, sizeof(struct sockaddr));
    // è¿™ä¸€æ­¥å¦‚æœæ²¡æœ‰è¶…çº§ç”¨æˆ·çš„æƒé™ï¼Œå°±ä¼šæŠ¥é”™ã€‚linuxå¯¹äºérootæƒé™ç”¨æˆ·ä¸èƒ½ä½¿ç”¨1024ä»¥ä¸‹çš„ç«¯å£
    exit_if(r, &amp;#34;bind to 0.0.0.0:%d failed %d %s&amp;#34;, port, errno, strerror(errno));
    /* 
    #include&amp;lt;sys/socket.h&amp;gt;
int listen(int sockfd, int backlog)
è¿”å›ï¼š0â”€â”€æˆåŠŸï¼Œ -1â”€â”€å¤±è´¥
å‚æ•°sockfd
è¢«listenå‡½æ•°ä½œç”¨çš„å¥—æ¥å­—ï¼Œsockfdä¹‹å‰ç”±socketå‡½æ•°è¿”å›ã€‚åœ¨è¢«socketå‡½æ•°è¿”å›çš„å¥—æ¥å­—fdä¹‹æ—¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸»åŠ¨è¿æ¥çš„å¥—æ¥å­—ï¼Œ
ä¹Ÿå°±æ˜¯æ­¤æ—¶ç³»ç»Ÿå‡è®¾ç”¨æˆ·ä¼šå¯¹è¿™ä¸ªå¥—æ¥å­—è°ƒç”¨connectå‡½æ•°ï¼ŒæœŸå¾…å®ƒä¸»åŠ¨ä¸å…¶å®ƒè¿›ç¨‹è¿æ¥ï¼Œç„¶ååœ¨æœåŠ¡å™¨ç¼–ç¨‹ä¸­ï¼Œç”¨æˆ·å¸Œæœ›è¿™ä¸ªå¥—æ¥å­—å¯ä»¥æ¥å—å¤–æ¥çš„è¿æ¥è¯·æ±‚ï¼Œ
ä¹Ÿå°±æ˜¯è¢«åŠ¨ç­‰å¾…ç”¨æˆ·æ¥è¿æ¥ã€‚ç”±äºç³»ç»Ÿé»˜è®¤æ—¶è®¤ä¸ºä¸€ä¸ªå¥—æ¥å­—æ˜¯ä¸»åŠ¨è¿æ¥çš„ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡æŸç§æ–¹å¼æ¥å‘Šè¯‰ç³»ç»Ÿï¼Œç”¨æˆ·è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨listenæ¥å®Œæˆè¿™ä»¶äº‹ã€‚
å‚æ•°backlog
è¿™ä¸ªå‚æ•°æ¶‰åŠåˆ°ä¸€äº›ç½‘ç»œçš„ç»†èŠ‚ã€‚åœ¨è¿›ç¨‹æ­£ç†ä¸€ä¸ªä¸€ä¸ªè¿æ¥è¯·æ±‚çš„æ—¶å€™ï¼Œå¯èƒ½è¿˜å­˜åœ¨å…¶å®ƒçš„è¿æ¥è¯·æ±‚ã€‚
å› ä¸ºTCPè¿æ¥æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥å¯èƒ½å­˜åœ¨ä¸€ç§åŠè¿æ¥çš„çŠ¶æ€ï¼Œæœ‰æ—¶ç”±äºåŒæ—¶å°è¯•è¿æ¥çš„ç”¨æˆ·è¿‡å¤šï¼Œä½¿å¾—æœåŠ¡å™¨è¿›ç¨‹æ— æ³•å¿«é€Ÿåœ°å®Œæˆè¿æ¥è¯·æ±‚ã€‚
å¦‚æœè¿™ä¸ªæƒ…å†µå‡ºç°äº†ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å¸Œæœ›å†…æ ¸å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ
å†…æ ¸ä¼šåœ¨è‡ªå·±çš„è¿›ç¨‹ç©ºé—´é‡Œç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ä»¥è·Ÿè¸ªè¿™äº›å®Œæˆçš„è¿æ¥ä½†æœåŠ¡å™¨è¿›ç¨‹è¿˜æ²¡æœ‰æ¥æ‰‹å¤„ç†æˆ–æ­£åœ¨è¿›è¡Œçš„è¿æ¥ï¼Œè¿™æ ·çš„ä¸€ä¸ªé˜Ÿåˆ—å†…æ ¸ä¸å¯èƒ½è®©å…¶ä»»æ„å¤§ï¼Œ
æ‰€ä»¥å¿…é¡»æœ‰ä¸€ä¸ªå¤§å°çš„ä¸Šé™ã€‚è¿™ä¸ªbacklogå‘Šè¯‰å†…æ ¸ä½¿ç”¨è¿™ä¸ªæ•°å€¼ä½œä¸ºä¸Šé™ã€‚
æ¯«æ— ç–‘é—®ï¼ŒæœåŠ¡å™¨è¿›ç¨‹ä¸èƒ½éšä¾¿æŒ‡å®šä¸€ä¸ªæ•°å€¼ï¼Œå†…æ ¸æœ‰ä¸€ä¸ªè®¸å¯çš„èŒƒå›´ã€‚è¿™ä¸ªèŒƒå›´æ˜¯å®ç°ç›¸å…³çš„ã€‚å¾ˆéš¾æœ‰æŸç§ç»Ÿä¸€ï¼Œä¸€èˆ¬è¿™ä¸ªå€¼ä¼šå°30ä»¥å†…ã€‚
å†…æ ¸ç”¨äºè·Ÿè¸ªè¿™äº›å®Œæˆè¿æ¥ä½†æ˜¯ç”¨æˆ·ä»£ç è¿˜æ²¡æœ‰é€šè¿‡acceptè°ƒç”¨çš„é˜Ÿåˆ—é•¿åº¦è¿™é‡Œè®¾ç½®ä¸ºäº†20ã€‚åœ¨é˜Ÿåˆ—é•¿åº¦å°äº20æ—¶ï¼Œå†…æ ¸ä¼šç«‹å³å®Œæˆè¿æ¥çš„å»ºç«‹ã€‚
ä½†æ˜¯å¦‚æœé˜Ÿåˆ—é•¿åº¦å¤§äº20ï¼Œåœ¨ç”¨æˆ·ä»£ç è°ƒç”¨acceptä¹‹å‰è¯¥è¿æ¥éƒ½ä¸ä¼šå»ºç«‹ï¼Œå¯¹æ–¹åˆ™å¤„äºé˜»å¡çŠ¶æ€ã€‚
     */
    r = listen(listenfd, 20);
    exit_if(r, &amp;#34;listen failed %d %s&amp;#34;, errno, strerror(errno));
    printf(&amp;#34;fd %d listening at %d\n&amp;#34;, listenfd, port);
    // æ¥ä¸‹æ¥è®¾ç½®æ–‡ä»¶æè¿°ç¬¦ä¸ºé˜»å¡ã€‚
    // ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸ºéé˜»å¡ï¼Ÿhttps://www.zhihu.com/question/23614342
    setNonBlock(listenfd);
    // å°†å…¶è®¾ç½®ä¸ºå¯è¯»å–æ—¶è§¦å‘ï¼Œæ·»åŠ åˆ°epollæ–‡ä»¶æè¿°ç¬¦æ± ä¸­
    updateEvents(epollfd, listenfd, EPOLLIN, EPOLL_CTL_ADD);
    for (;;) { //å®é™…åº”ç”¨åº”å½“æ³¨å†Œä¿¡å·å¤„ç†å‡½æ•°ï¼Œé€€å‡ºæ—¶æ¸…ç†èµ„æº
        loop_once(epollfd, listenfd, 10000);
    }
    return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;è¿è¡Œæ•ˆæœ&#34;&gt;è¿è¡Œæ•ˆæœ
&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;https://upload-images.jianshu.io/upload_images/4388248-57aa370a0545fdb4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo ./epoll
fd 4 listening at 80
add fd 4 events read 1 write 0
epoll_wait return 1
this is accept
accept a connection from 127.0.0.1
add fd 5 events read 1 write 0
epoll_wait return 1
this can read
read 412 bytes
now info is
---GET / HTTP/1.1
Host: 127.0.0.1
Connection: keep-alive
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36
Upgrade-Insecure-Requests: 1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,und;q=0.8,zh-TW;q=0.7,en;q=0.6,pl;q=0.5


---
write 4081834 bytes left: 14966851
update it to EPOLLIN|EPOLLOUT
mod fd 5 events read 1 write 4
nothing to read from 5, return.
epoll_wait return 1
handling epollout
write 2226422 bytes left: 12740429
epoll_wait return 1
handling epollout
write 2095456 bytes left: 10644973
epoll_wait return 1
handling epollout
write 1964490 bytes left: 8680483
epoll_wait return 1
handling epollout
write 1506109 bytes left: 7174374
epoll_wait return 1
handling epollout
write 1833524 bytes left: 5340850
epoll_wait return 1
handling epollout
write 1637075 bytes left: 3703775
write 130966 bytes left: 3572809
epoll_wait return 1
handling epollout
write 1571592 bytes left: 2001217
epoll_wait return 1
handling epollout
write 1440626 bytes left: 560591
epoll_wait return 1
handling epollout
write 560591 bytes left: 0
mod fd 5 events read 1 write 0
epoll_wait return 1
this can read
read 375 bytes
now info is
---GET /favicon.ico HTTP/1.1
Host: 127.0.0.1
Connection: keep-alive
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36
Accept: image/webp,image/apng,image/*,*/*;q=0.8
Referer: http://127.0.0.1/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,und;q=0.8,zh-TW;q=0.7,en;q=0.6,pl;q=0.5


---
write 10477280 bytes left: 8571405
update it to EPOLLIN|EPOLLOUT
mod fd 5 events read 1 write 4
nothing to read from 5, return.
epoll_wait return 1
handling epollout
write 1440626 bytes left: 7130779
epoll_wait return 1
handling epollout
write 1768041 bytes left: 5362738
epoll_wait return 1
handling epollout
write 1571592 bytes left: 3791146
epoll_wait return 1
handling epollout
write 1637075 bytes left: 2154071
epoll_wait return 1
handling epollout
write 1702558 bytes left: 451513
epoll_wait return 1
handling epollout
write 451513 bytes left: 0
mod fd 5 events read 1 write 0
epoll_wait return 0
epoll_wait return 0
epoll_wait return 0
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œæˆ‘å‘é€çš„èµ„æºæ”¹å¤§äº†ï¼Œæ”¹æˆå¦‚ä¸‹çš„æ•°å€¼ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    httpRes = &amp;#34;HTTP/1.1 200 OK\r\nConnection: Keep-Alive\r\nContent-Type: text/html; charset=UTF-8\r\nContent-Length: 19048576\r\n\r\n123456&amp;#34;;
    // å°†å‰©ä¸‹çš„å†…å®¹å¡«å……æˆ0ã€‚æœ€åcontentçš„é•¿åº¦æ˜¯å¤§çº¦1024*1024
    for(int i=0;i&amp;lt;19048570;i++) {
        httpRes+=&amp;#39;\0&amp;#39;;
    }
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°åˆ†äº†å¤šæ¬¡ä¼ è¾“ã€‚æœ€ç»ˆç»ˆç«¯é¡µé¢ä¸Šæ˜¾ç¤º123456ï¼Œåé¢å…¨éƒ½æ˜¯\0ï¼Œä¸ä¼šæ˜¾ç¤ºã€‚
å¯ä»¥çœ‹åˆ°æµè§ˆå™¨è¯·æ±‚äº†ä¸¤æ¬¡ï¼Œä¸€æ¬¡è¯·æ±‚æ ¹ç›®å½•ï¼Œä¸€æ¬¡è¯·æ±‚é¡µé¢çš„å›¾æ ‡favicon.ico&lt;/p&gt;
</description>
        </item>
        <item>
        <title>TCP UDP IPæœ€å¤§æŠ¥æ–‡é•¿åº¦</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/tcp-udp-ip%E6%9C%80%E5%A4%A7%E6%8A%A5%E6%96%87%E9%95%BF%E5%BA%A6/</link>
        <pubDate>Mon, 26 Mar 2018 16:41:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/tcp-udp-ip%E6%9C%80%E5%A4%A7%E6%8A%A5%E6%96%87%E9%95%BF%E5%BA%A6/</guid>
        <description>&lt;h2 id=&#34;udp&#34;&gt;UDP
&lt;/h2&gt;&lt;p&gt;å¯¹äºUDPåè®®æ¥è¯´ï¼Œæ•´ä¸ªåŒ…çš„æœ€å¤§é•¿åº¦ä¸º65535ï¼Œå…¶ä¸­åŒ…å¤´é•¿åº¦æ˜¯65535-20=65515ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tcp&#34;&gt;TCP
&lt;/h2&gt;&lt;p&gt;å¯¹äºTCPåè®®æ¥è¯´ï¼Œæ•´ä¸ªåŒ…çš„æœ€å¤§é•¿åº¦æ˜¯ç”±æœ€å¤§ä¼ è¾“å¤§å°ï¼ˆMSSï¼ŒMaxitum Segment Sizeï¼‰å†³å®šï¼ŒMSSå°±æ˜¯TCPæ•°æ®åŒ…æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åˆ†æ®µã€‚ä¸ºäº†è¾¾åˆ°æœ€ä½³çš„ä¼ è¾“æ•ˆèƒ½TCPåè®®åœ¨å»ºç«‹è¿æ¥çš„æ—¶å€™é€šå¸¸è¦åå•†åŒæ–¹çš„MSSå€¼ï¼Œè¿™ä¸ªå€¼TCPåè®®åœ¨å®ç°çš„æ—¶å€™å¾€å¾€ç”¨MTUå€¼ä»£æ›¿ï¼ˆéœ€è¦å‡å»IPæ•°æ®åŒ…åŒ…å¤´çš„å¤§å°20Byteså’ŒTCPæ•°æ®æ®µçš„åŒ…å¤´20Bytesï¼‰æ‰€ä»¥å¾€å¾€MSSä¸º1460ã€‚é€šè®¯åŒæ–¹ä¼šæ ¹æ®åŒæ–¹æä¾›çš„MSSå€¼å¾—æœ€å°å€¼ç¡®å®šä¸ºè¿™æ¬¡è¿æ¥çš„æœ€å¤§MSSå€¼ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ip&#34;&gt;IP
&lt;/h2&gt;&lt;p&gt;å¯¹äºIPåè®®æ¥è¯´ï¼ŒIPåŒ…çš„å¤§å°ç”±MTUå†³å®šã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>TCP æŠ¥æ–‡æ ¼å¼ HTTPæŠ¥æ–‡æ ¼å¼</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/tcp-%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F-http%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F/</link>
        <pubDate>Mon, 26 Mar 2018 16:37:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/tcp-%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F-http%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F/</guid>
        <description>&lt;h2 id=&#34;tcp&#34;&gt;TCP
&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;æºç«¯å£ ç›®æ ‡ç«¯å£
    åºå·
    ç¡®è®¤å·
ä½æ ‡è¯†   çª—å£
æ ¡éªŒå’Œ   ç´§æ€¥æŒ‡é’ˆ
    é€‰é¡¹
    æ•°æ®
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;http&#34;&gt;HTTP
&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;è¯·æ±‚ URL åè®®ç‰ˆæœ¬\r\n
å­—æ®µï¼šå€¼\r\n
\r\n
æ­£æ–‡
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;åè®®ç‰ˆæœ¬ çŠ¶æ€ç  çŠ¶æ€ç æè¿°\r\n
å­—æ®µï¼šå€¼\r\n
\r\n
æ­£æ–‡
&lt;/code&gt;&lt;/pre&gt;</description>
        </item>
        <item>
        <title>TCP UDP é€šè¿‡socketå»ºç«‹è¿æ¥çš„è¿‡ç¨‹</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/tcp-udp-%E9%80%9A%E8%BF%87socket%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%BF%87%E7%A8%8B/</link>
        <pubDate>Mon, 26 Mar 2018 14:46:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/tcp-udp-%E9%80%9A%E8%BF%87socket%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%BF%87%E7%A8%8B/</guid>
        <description>&lt;h2 id=&#34;tcp&#34;&gt;TCP
&lt;/h2&gt;&lt;p&gt;|    é˜¶æ®µ    | æœåŠ¡å™¨    |  å®¢æˆ·ç«¯  |
| &amp;mdash;&amp;mdash;&amp;ndash;   | &amp;mdash;&amp;ndash;:   | :&amp;mdash;-: |
|         | socket      |   socket    |
|         | bind      |        |
|        | listen      |        |
|        | accept     |   connect    |
|         | write      |   write    |
|         | read      |   read   |
|         | close      |   close   |&lt;/p&gt;
&lt;h2 id=&#34;udp&#34;&gt;UDP
&lt;/h2&gt;&lt;p&gt;|    é˜¶æ®µ    | æœåŠ¡å™¨    |  å®¢æˆ·ç«¯  |
| &amp;mdash;&amp;mdash;&amp;ndash;   | &amp;mdash;&amp;ndash;:   | :&amp;mdash;-: |
|         | socket      |   socket    |
|         | bind      |        |
|         | sendto      |   recvfrom    |
|         | recvfrom      |   sendto   |
|         | close      |   close   |&lt;/p&gt;
</description>
        </item>
        <item>
        <title>HTTPS åŒå‘åŠ å¯†è¿‡ç¨‹åˆ†æ</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/https-%E5%8F%8C%E5%90%91%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90/</link>
        <pubDate>Mon, 26 Mar 2018 14:42:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/https-%E5%8F%8C%E5%90%91%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90/</guid>
        <description>&lt;p&gt;HTTPSè®¤è¯è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;â‘  æµè§ˆå™¨å‘é€ä¸€ä¸ªè¿æ¥è¯·æ±‚ç»™å®‰å…¨æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘¡ æœåŠ¡å™¨å°†è‡ªå·±çš„è¯ä¹¦ï¼Œä»¥åŠåŒè¯ä¹¦ç›¸å…³çš„ä¿¡æ¯å‘é€ç»™å®¢æˆ·æµè§ˆå™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘¢ å®¢æˆ·æµè§ˆå™¨æ£€æŸ¥æœåŠ¡å™¨é€è¿‡æ¥çš„è¯ä¹¦æ˜¯å¦æ˜¯ç”±è‡ªå·±ä¿¡èµ–çš„ CA ä¸­å¿ƒæ‰€ç­¾å‘çš„ã€‚å¦‚æœæ˜¯ï¼Œå°±ç»§ç»­æ‰§è¡Œåè®®ï¼›å¦‚æœä¸æ˜¯ï¼Œå®¢æˆ·æµè§ˆå™¨å°±ç»™å®¢æˆ·ä¸€ä¸ªè­¦å‘Šæ¶ˆæ¯ï¼šè­¦å‘Šå®¢æˆ·è¿™ä¸ªè¯ä¹¦ä¸æ˜¯å¯ä»¥ä¿¡èµ–çš„ï¼Œè¯¢é—®å®¢æˆ·æ˜¯å¦éœ€è¦ç»§ç»­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘£ æ¥ç€å®¢æˆ·æµè§ˆå™¨æ¯”è¾ƒè¯ä¹¦é‡Œçš„æ¶ˆæ¯ï¼Œä¾‹å¦‚åŸŸåå’Œå…¬é’¥ï¼Œä¸æœåŠ¡å™¨åˆšåˆšå‘é€çš„ç›¸å…³æ¶ˆæ¯æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœæ˜¯ä¸€è‡´çš„ï¼Œå®¢æˆ·æµè§ˆå™¨è®¤å¯è¿™ä¸ªæœåŠ¡å™¨çš„åˆæ³•èº«ä»½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘¤ æœåŠ¡å™¨è¦æ±‚å®¢æˆ·å‘é€å®¢æˆ·è‡ªå·±çš„è¯ä¹¦ã€‚æ”¶åˆ°åï¼ŒæœåŠ¡å™¨éªŒè¯å®¢æˆ·çš„è¯ä¹¦ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡éªŒè¯ï¼Œæ‹’ç»è¿æ¥ï¼›å¦‚æœé€šè¿‡éªŒè¯ï¼ŒæœåŠ¡å™¨è·å¾—ç”¨æˆ·çš„å…¬é’¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘¥ å®¢æˆ·æµè§ˆå™¨å‘Šè¯‰æœåŠ¡å™¨è‡ªå·±æ‰€èƒ½å¤Ÿæ”¯æŒçš„é€šè®¯å¯¹ç§°å¯†ç æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘¦ æœåŠ¡å™¨ä»å®¢æˆ·å‘é€è¿‡æ¥çš„å¯†ç æ–¹æ¡ˆä¸­ï¼Œé€‰æ‹©ä¸€ç§åŠ å¯†ç¨‹åº¦æœ€é«˜çš„å¯†ç æ–¹æ¡ˆï¼Œç”¨å®¢æˆ·çš„å…¬é’¥åŠ è¿‡å¯†åé€šçŸ¥æµè§ˆå™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘§ æµè§ˆå™¨é’ˆå¯¹è¿™ä¸ªå¯†ç æ–¹æ¡ˆï¼Œé€‰æ‹©ä¸€ä¸ªé€šè¯å¯†é’¥ï¼Œæ¥ç€ç”¨æœåŠ¡å™¨çš„å…¬é’¥åŠ è¿‡å¯†åå‘é€ç»™æœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘¨ æœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ï¼Œè·å¾—é€šè¯å¯†é’¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â‘© æœåŠ¡å™¨ã€æµè§ˆå™¨æ¥ä¸‹æ¥çš„é€šè®¯éƒ½æ˜¯ç”¨å¯¹ç§°å¯†ç æ–¹æ¡ˆï¼Œå¯¹ç§°å¯†é’¥æ˜¯åŠ è¿‡å¯†çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢æ‰€è¿°çš„æ˜¯åŒå‘è®¤è¯ SSL åè®®çš„å…·ä½“é€šè®¯è¿‡ç¨‹ï¼Œè¿™ç§æƒ…å†µè¦æ±‚æœåŠ¡å™¨å’Œç”¨æˆ·åŒæ–¹éƒ½æœ‰è¯ä¹¦ã€‚å•å‘è®¤è¯ SSL åè®®ä¸éœ€è¦å®¢æˆ·æ‹¥æœ‰ CA è¯ä¹¦ï¼Œå…·ä½“çš„è¿‡ç¨‹ç›¸å¯¹äºä¸Šé¢çš„æ­¥éª¤ï¼Œåªéœ€å°†æœåŠ¡å™¨ç«¯éªŒè¯å®¢æˆ·è¯ä¹¦çš„è¿‡ç¨‹å»æ‰ï¼Œä»¥åŠåœ¨åå•†å¯¹ç§°å¯†ç æ–¹æ¡ˆï¼Œå¯¹ç§°é€šè¯å¯†é’¥æ—¶ï¼ŒæœåŠ¡å™¨å‘é€ç»™å®¢æˆ·çš„æ˜¯æ²¡æœ‰åŠ è¿‡å¯†çš„ ï¼ˆè¿™å¹¶ä¸å½±å“ SSL è¿‡ç¨‹çš„å®‰å…¨æ€§ï¼‰å¯†ç æ–¹æ¡ˆã€‚è¿™æ ·ï¼ŒåŒæ–¹å…·ä½“çš„é€šè®¯å†…å®¹ï¼Œå°±æ˜¯åŠ è¿‡å¯†çš„æ•°æ®ï¼Œå¦‚æœæœ‰ç¬¬ä¸‰æ–¹æ”»å‡»ï¼Œè·å¾—çš„åªæ˜¯åŠ å¯†çš„æ•°æ®ï¼Œç¬¬ä¸‰æ–¹è¦è·å¾—æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå°±éœ€è¦å¯¹åŠ å¯† çš„æ•°æ®è¿›è¡Œè§£å¯†ï¼Œè¿™æ—¶å€™çš„å®‰å…¨å°±ä¾èµ–äºå¯†ç æ–¹æ¡ˆçš„å®‰å…¨ã€‚è€Œå¹¸è¿çš„æ˜¯ï¼Œç›®å‰æ‰€ç”¨çš„å¯†ç æ–¹æ¡ˆï¼Œåªè¦é€šè®¯å¯†é’¥é•¿åº¦è¶³å¤Ÿçš„é•¿ï¼Œå°±è¶³å¤Ÿçš„å®‰å…¨ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¼ºè°ƒè¦æ±‚ä½¿ç”¨128 ä½åŠ å¯†é€šè®¯çš„åŸå› ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>select poll epoll ç®€æ˜ä»‹ç»</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/select-poll-epoll-%E7%AE%80%E6%98%8E%E4%BB%8B%E7%BB%8D/</link>
        <pubDate>Mon, 12 Mar 2018 13:19:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/select-poll-epoll-%E7%AE%80%E6%98%8E%E4%BB%8B%E7%BB%8D/</guid>
        <description>&lt;p&gt;æ¥æº &lt;a class=&#34;link&#34; href=&#34;https://cloud.tencent.com/developer/article/1005481&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;https://cloud.tencent.com/developer/article/1005481&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;å‡½æ•°ç®€ä»‹&#34;&gt;å‡½æ•°ç®€ä»‹
&lt;/h1&gt;&lt;h2 id=&#34;select&#34;&gt;select
&lt;/h2&gt;&lt;p&gt;å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int select (int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;fd_setæ˜¯åŒ…å«æœ‰æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆï¼Œæ˜¯ä¸€ä¸ªä½å›¾ï¼Œæ€»å…±æœ‰nä½ã€‚è¿™æ„å‘³è¿™æ¯æ¬¡è°ƒç”¨å°±ä¼šæ‹·è´ä¸€æ¬¡æ–‡ä»¶æè¿°ç¬¦é›†åˆåˆ°å†…æ ¸ã€‚&lt;/p&gt;
&lt;h2 id=&#34;poll&#34;&gt;poll
&lt;/h2&gt;&lt;p&gt;å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int poll (struct pollfd *fds, unsigned int nfds, int timeout);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸åŒä¸selectä½¿ç”¨ä¸‰ä¸ªä½å›¾æ¥è¡¨ç¤ºä¸‰ä¸ªfdsetçš„æ–¹å¼ï¼Œpollä½¿ç”¨ä¸€ä¸ª pollfdçš„æ•°ç»„å®ç°ã€‚ä¼ å…¥ä»–çš„é•¿åº¦ï¼Œä»¥åŠè¶…æ—¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;epoll&#34;&gt;epoll
&lt;/h2&gt;&lt;p&gt;epollæ˜¯åœ¨2.6å†…æ ¸ä¸­æå‡ºçš„ï¼Œæ˜¯ä¹‹å‰çš„selectå’Œpollçš„å¢å¼ºç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;int epoll_create(int size)ï¼›//åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§
int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›
int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;epoll_createæ˜¯ç”¨äºåˆ›å»ºepollçš„å¥æŸ„ã€‚sizeæ˜¯å»ºè®®å†…æ ¸é¢„å…ˆåˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œä¸ä¼šé™åˆ¶å®é™…è¿è¡Œçš„æ•°ç›®ã€‚
epoll_ctlä¼šæ§åˆ¶epollçš„å¥æŸ„ï¼Œæˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦ã€‚ctlä¸epoll_waitç›¸åˆ†ç¦»çš„æœºåˆ¶ä½¿å¾—åªç”¨å¤åˆ¶ä¸€æ¬¡äº‹ä»¶é›†åˆã€‚
epoll_waitå¯ä»¥ç”¨äºè·å¾—ä»å†…æ ¸å¾—åˆ°çš„äº‹ä»¶çš„é›†åˆã€‚&lt;/p&gt;
&lt;h1 id=&#34;socket-äº‹ä»¶&#34;&gt;socket äº‹ä»¶
&lt;/h1&gt;&lt;p&gt;åœ¨Linux 2.6å†…æ ¸äº‹ä»¶ä¸­ï¼Œè®¾ç½®äº†wakeup callbackæœºåˆ¶ã€‚å½“socketåœ¨ç­‰å¾…äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç”±å†…æ ¸çš„socketç¡çœ é˜Ÿåˆ—ç®¡ç†ã€‚å½“socketäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šé¡ºåºéå†socketç¡çœ é˜Ÿåˆ—ä¸Šçš„æ¯ä¸ªprocessï¼Œé€šçŸ¥è¯¥è¿›ç¨‹äº‹ä»¶å‘ç”Ÿã€‚é€šçŸ¥æ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ€åˆçš„select&#34;&gt;æœ€åˆçš„select
&lt;/h2&gt;&lt;p&gt;selectæœ€åˆåªæ˜¯ä¸€ä¸ªæœ´ç´ çš„å®ç°ï¼Œæ¥å°è¯•è§£å†³å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ£€æŸ¥é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;selectåšäº†ä»€ä¹ˆ&#34;&gt;selectåšäº†ä»€ä¹ˆï¼Ÿ
&lt;/h3&gt;&lt;p&gt;selectè°ƒç”¨åï¼Œåšäº†ä»¥ä¸‹äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†å‚æ•°ä¼ è¿›æ¥çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸ç©ºé—´&lt;/li&gt;
&lt;li&gt;ä¾æ¬¡éå†æ–‡ä»¶æè¿°ç¬¦ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰äº‹ä»¶å¯è¯»ï¼Œå¦‚æœå¯è¯»å°±è¿”å›&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰å¯è¯»çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¼€å§‹ç¡çœ ï¼Œç­‰å¾…å†…æ ¸socketäº‹ä»¶å‘ç”Ÿ&lt;/li&gt;
&lt;li&gt;è¢«å”¤é†’ï¼Œå†æ¬¡æ£€æŸ¥åˆ°åº•æ˜¯å“ªä¸ªæ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿäº†æ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;selectçš„é—®é¢˜&#34;&gt;selectçš„é—®é¢˜ï¼Ÿ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ¯æ¬¡è°ƒç”¨socketéƒ½ä¼šæ‹·è´ä¸€æ¬¡åˆ°å†…æ ¸ç©ºé—´ï¼Œæ€§èƒ½ä½ä¸‹&lt;/li&gt;
&lt;li&gt;ä»»æ„ä¸€ä¸ªsocketè¢«å”¤é†’éƒ½éœ€è¦éå†æ‰€æœ‰çš„socketï¼Œæµªè´¹æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;selectçš„æ”¹è¿›&#34;&gt;selectçš„æ”¹è¿›ï¼Ÿ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;è¢«ç›‘æ§çš„fdsé›†åˆé™åˆ¶ä¸º1024ï¼Œ1024å¤ªå°äº†ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæœ‰ä¸ªæ¯”è¾ƒå¤§çš„å¯ç›‘æ§fdsé›†åˆ&lt;/li&gt;
&lt;li&gt;fdsé›†åˆéœ€è¦ä»ç”¨æˆ·ç©ºé—´æ‹·è´åˆ°å†…æ ¸ç©ºé—´çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸éœ€è¦æ‹·è´&lt;/li&gt;
&lt;li&gt;è¢«ç›‘æ§çš„fdsä¸­æŸäº›æœ‰æ•°æ®å¯è¯»çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›é€šçŸ¥æ›´åŠ ç²¾ç»†ä¸€ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä»é€šçŸ¥ä¸­å¾—åˆ°æœ‰å¯è¯»äº‹ä»¶çš„fdsåˆ—è¡¨ï¼Œè€Œä¸æ˜¯éœ€è¦éå†æ•´ä¸ªfdsæ¥æ”¶é›†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;é¸¡è‚‹çš„poll&#34;&gt;é¸¡è‚‹çš„poll
&lt;/h2&gt;&lt;p&gt;pollåªè§£å†³äº†ç¬¬ä¸€ä¸ªé—®é¢˜ã€‚fdsçš„å¤§å°æ˜¯1024é™åˆ¶çš„é—®é¢˜ã€‚ä»…ä»…æ˜¯ä¼ å…¥çš„å‚æ•°çš„æ¥å£å˜äº†è€Œå·²ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æˆç†Ÿçš„epoll&#34;&gt;æˆç†Ÿçš„epoll
&lt;/h2&gt;&lt;p&gt;epollè§£å†³äº†ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºç¬¬äºŒä¸ªé—®é¢˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‹†åˆ†å‡½æ•°è°ƒç”¨ï¼Œå†ç»†åˆ†å‡½æ•°è°ƒç”¨
å¯¹äºIOå¤šè·¯å¤ç”¨ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œæ¯æ¬¡è°ƒç”¨selectæˆ–polléƒ½åœ¨é‡å¤åœ°å‡†å¤‡(é›†ä¸­å¤„ç†)æ•´ä¸ªéœ€è¦ç›‘æ§çš„fdsé›†åˆã€‚ç„¶è€Œå¯¹äºé¢‘ç¹è°ƒç”¨çš„selectæˆ–pollè€Œè¨€ï¼Œfdsé›†åˆçš„å˜åŒ–é¢‘ç‡è¦ä½å¾—å¤šï¼Œæˆ‘ä»¬æ²¡å¿…è¦æ¯æ¬¡éƒ½é‡æ–°å‡†å¤‡(é›†ä¸­å¤„ç†)æ•´ä¸ªfdsé›†åˆã€‚
äºæ˜¯ï¼Œepollå¼•å…¥äº†epoll_ctlç³»ç»Ÿè°ƒç”¨ï¼Œå°†é«˜é¢‘è°ƒç”¨çš„epoll_waitå’Œä½é¢‘çš„epoll_ctléš”ç¦»å¼€ã€‚åŒæ—¶ï¼Œepoll_ctlé€šè¿‡(EPOLL_CTL_ADDã€EPOLL_CTL_MODã€EPOLL_CTL_DEL)ä¸‰ä¸ªæ“ä½œæ¥åˆ†æ•£å¯¹éœ€è¦ç›‘æ§çš„fdsé›†åˆçš„ä¿®æ”¹ï¼Œåšåˆ°äº†æœ‰å˜åŒ–æ‰å˜æ›´ï¼Œå°†selectæˆ–pollé«˜é¢‘ã€å¤§å—å†…å­˜æ‹·è´(é›†ä¸­å¤„ç†)å˜æˆepoll_ctlçš„ä½é¢‘ã€å°å—å†…å­˜çš„æ‹·è´(åˆ†æ•£å¤„ç†)ï¼Œé¿å…äº†å¤§é‡çš„å†…å­˜æ‹·è´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨çº¢é»‘æ ‘
å¦å¤–ï¼Œepollé€šè¿‡epoll_ctlæ¥å¯¹ç›‘æ§çš„fdsé›†åˆæ¥è¿›è¡Œå¢ã€åˆ ã€æ”¹ï¼Œé‚£ä¹ˆå¿…é¡»æ¶‰åŠåˆ°fdçš„å¿«é€ŸæŸ¥æ‰¾é—®é¢˜ï¼Œäºæ˜¯ï¼Œä¸€ä¸ªä½æ—¶é—´å¤æ‚åº¦çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥çš„æ•°æ®ç»“æ„æ¥ç»„ç»‡è¢«ç›‘æ§çš„fdsé›†åˆæ˜¯å¿…ä¸å¯å°‘çš„äº†ã€‚åœ¨linux 2.6.8ä¹‹å‰çš„å†…æ ¸ï¼Œepollä½¿ç”¨hashæ¥ç»„ç»‡fdsé›†åˆï¼Œäºæ˜¯åœ¨åˆ›å»ºepoll fdçš„æ—¶å€™ï¼Œepolléœ€è¦åˆå§‹åŒ–hashçš„å¤§å°ã€‚äºæ˜¯epoll_create(int size)æœ‰ä¸€ä¸ªå‚æ•°sizeï¼Œä»¥ä¾¿å†…æ ¸æ ¹æ®sizeçš„å¤§å°æ¥åˆ†é…hashçš„å¤§å°ã€‚åœ¨linux 2.6.8ä»¥åçš„å†…æ ¸ä¸­ï¼Œepollä½¿ç”¨çº¢é»‘æ ‘æ¥ç»„ç»‡ç›‘æ§çš„fdsé›†åˆï¼Œäºæ˜¯epoll_create(int size)çš„å‚æ•°sizeå®é™…ä¸Šå·²ç»æ²¡æœ‰æ„ä¹‰äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºç¬¬ä¸‰ä¸ªé—®é¢˜&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å›è°ƒæœºåˆ¶
é€šè¿‡ä¸Šé¢çš„socketçš„ç¡çœ é˜Ÿåˆ—å”¤é†’é€»è¾‘æˆ‘ä»¬çŸ¥é“ï¼Œsocketå”¤é†’ç¡çœ åœ¨å…¶ç¡çœ é˜Ÿåˆ—çš„wait_entry(process)çš„æ—¶å€™ä¼šè°ƒç”¨wait_entryçš„å›è°ƒå‡½æ•°callbackï¼Œå¹¶ä¸”ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨callbackä¸­åšä»»ä½•äº‹æƒ…ã€‚ä¸ºäº†åšåˆ°åªéå†å°±ç»ªçš„fdï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸ªåœ°æ–¹æ¥ç»„ç»‡é‚£äº›å·²ç»å°±ç»ªçš„fdã€‚ä¸ºæ­¤ï¼Œepollå¼•å…¥äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œä¸€ä¸ªåŒå‘é“¾è¡¨(ready_list)ï¼Œä¸€ä¸ªå•ç‹¬çš„ç¡çœ é˜Ÿåˆ—(single_epoll_wait_list)ï¼Œå¹¶ä¸”ï¼Œä¸selectæˆ–pollä¸åŒçš„æ˜¯ï¼Œepollçš„processä¸éœ€è¦åŒæ—¶æ’å…¥åˆ°å¤šè·¯å¤ç”¨çš„socketé›†åˆçš„æ‰€æœ‰ç¡çœ é˜Ÿåˆ—ä¸­ï¼Œç›¸åprocessåªæ˜¯æ’å…¥åˆ°ä¸­é—´å±‚çš„epollçš„å•ç‹¬ç¡çœ é˜Ÿåˆ—ä¸­ï¼Œprocessç¡çœ åœ¨epollçš„å•ç‹¬é˜Ÿåˆ—ä¸Šï¼Œç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚åŒæ—¶ï¼Œå¼•å…¥ä¸€ä¸ªä¸­é—´çš„wait_entry_skï¼Œå®ƒä¸æŸä¸ªsocket skå¯†åˆ‡ç›¸å…³ï¼Œwait_entry_skç¡çœ åœ¨skçš„ç¡çœ é˜Ÿåˆ—ä¸Šï¼Œå…¶callbackå‡½æ•°é€»è¾‘æ˜¯å°†å½“å‰skæ’å…¥åˆ°epollçš„ready_listä¸­ï¼Œå¹¶å”¤é†’epollçš„single_epoll_wait_listã€‚è€Œsingle_epoll_wait_listä¸Šç¡çœ çš„processçš„å›è°ƒå‡½æ•°å°±æ˜æœ—äº†ï¼šéå†ready_listä¸Šçš„æ‰€æœ‰skï¼ŒæŒ¨ä¸ªè°ƒç”¨skçš„pollå‡½æ•°æ”¶é›†äº‹ä»¶ï¼Œç„¶åå”¤é†’processä»epoll_waitè¿”å›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æœ€åè¾¹ç¼˜è§¦å‘ä¸æ°´å¹³è§¦å‘&#34;&gt;æœ€åï¼Œè¾¹ç¼˜è§¦å‘ä¸æ°´å¹³è§¦å‘
&lt;/h2&gt;&lt;p&gt;è¯´åˆ°Epollå°±ä¸èƒ½ä¸è¯´è¯´Epolläº‹ä»¶çš„ä¸¤ç§æ¨¡å¼äº†ï¼Œä¸‹é¢æ˜¯ä¸¤ä¸ªæ¨¡å¼çš„åŸºæœ¬æ¦‚å¿µ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Edge Triggered (ET) è¾¹æ²¿è§¦å‘
.socketçš„æ¥æ”¶ç¼“å†²åŒºçŠ¶æ€å˜åŒ–æ—¶è§¦å‘è¯»äº‹ä»¶ï¼Œå³ç©ºçš„æ¥æ”¶ç¼“å†²åŒºåˆšæ¥æ”¶åˆ°æ•°æ®æ—¶è§¦å‘è¯»äº‹ä»¶
.socketçš„å‘é€ç¼“å†²åŒºçŠ¶æ€å˜åŒ–æ—¶è§¦å‘å†™äº‹ä»¶ï¼Œå³æ»¡çš„ç¼“å†²åŒºåˆšç©ºå‡ºç©ºé—´æ—¶è§¦å‘è¯»äº‹ä»¶
ä»…åœ¨ç¼“å†²åŒºçŠ¶æ€å˜åŒ–æ—¶è§¦å‘äº‹ä»¶ï¼Œæ¯”å¦‚æ•°æ®ç¼“å†²å»ä»æ— åˆ°æœ‰çš„æ—¶å€™(ä¸å¯è¯»-å¯è¯»)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Level Triggered (LT) æ°´å¹³è§¦å‘
.socketæ¥æ”¶ç¼“å†²åŒºä¸ä¸ºç©ºï¼Œæœ‰æ•°æ®å¯è¯»ï¼Œåˆ™è¯»äº‹ä»¶ä¸€ç›´è§¦å‘
.socketå‘é€ç¼“å†²åŒºä¸æ»¡å¯ä»¥ç»§ç»­å†™å…¥æ•°æ®ï¼Œåˆ™å†™äº‹ä»¶ä¸€ç›´è§¦å‘
ç¬¦åˆæ€ç»´ä¹ æƒ¯ï¼Œepoll_waitè¿”å›çš„äº‹ä»¶å°±æ˜¯socketçš„çŠ¶æ€&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>HTTPé•¿è¿æ¥ä¸çŸ­è¿æ¥</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/http%E9%95%BF%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%9F%AD%E8%BF%9E%E6%8E%A5/</link>
        <pubDate>Wed, 07 Mar 2018 03:15:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/http%E9%95%BF%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%9F%AD%E8%BF%9E%E6%8E%A5/</guid>
        <description>&lt;h2 id=&#34;httpåè®®ä¸tcpipåè®®çš„å…³ç³»&#34;&gt;HTTPåè®®ä¸TCP/IPåè®®çš„å…³ç³»
&lt;/h2&gt;&lt;p&gt;HTTPçš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥æœ¬è´¨ä¸Šæ˜¯TCPé•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚HTTPå±äºåº”ç”¨å±‚åè®®ï¼Œåœ¨ä¼ è¾“å±‚ä½¿ç”¨TCPåè®®ï¼Œåœ¨ç½‘ç»œå±‚ä½¿ç”¨IPåè®®ã€‚IPåè®®ä¸»è¦è§£å†³ç½‘ç»œè·¯ç”±å’Œå¯»å€é—®é¢˜ï¼ŒTCPåè®®ä¸»è¦è§£å†³å¦‚ä½•åœ¨IPå±‚ä¹‹ä¸Šå¯é çš„ä¼ é€’æ•°æ®åŒ…ï¼Œä½¿åœ¨ç½‘ç»œä¸Šçš„å¦ä¸€ç«¯æ”¶åˆ°å‘ç«¯å‘å‡ºçš„æ‰€æœ‰åŒ…ï¼Œå¹¶ä¸”é¡ºåºä¸å‘å‡ºé¡ºåºä¸€è‡´ã€‚TCPæœ‰å¯é ï¼Œé¢å‘è¿æ¥çš„ç‰¹ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¦‚ä½•ç†è§£httpåè®®æ˜¯æ— çŠ¶æ€çš„&#34;&gt;å¦‚ä½•ç†è§£HTTPåè®®æ˜¯æ— çŠ¶æ€çš„
&lt;/h2&gt;&lt;p&gt;HTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼ŒæŒ‡çš„æ˜¯åè®®å¯¹äºäº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆçŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰“å¼€ä¸€ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µå’Œä½ ä¹‹å‰æ‰“å¼€è¿™ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ã€‚HTTPæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„é¢å‘è¿æ¥çš„åè®®ï¼Œæ— çŠ¶æ€ä¸ä»£è¡¨HTTPä¸èƒ½ä¿æŒTCPè¿æ¥ï¼Œæ›´ä¸èƒ½ä»£è¡¨HTTPä½¿ç”¨çš„æ˜¯UDPåè®®ï¼ˆæ— è¿æ¥ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯é•¿è¿æ¥çŸ­è¿æ¥&#34;&gt;ä»€ä¹ˆæ˜¯é•¿è¿æ¥ã€çŸ­è¿æ¥
&lt;/h2&gt;&lt;p&gt;åœ¨HTTP/1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä½†ä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ã€‚å¦‚æœå®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®çš„æŸä¸ªHTMLæˆ–å…¶ä»–ç±»å‹çš„ Webé¡µä¸­åŒ…å«æœ‰å…¶ä»–çš„Webèµ„æºï¼Œå¦‚JavaScriptæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€CSSæ–‡ä»¶ç­‰ï¼›å½“æµè§ˆå™¨æ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªWebèµ„æºï¼Œå°±ä¼šå»ºç«‹ä¸€ä¸ªHTTPä¼šè¯ã€‚ä½†ä» HTTP/1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„HTTPåè®®ï¼Œä¼šåœ¨å“åº”å¤´æœ‰åŠ å…¥è¿™è¡Œä»£ç ï¼š&lt;code&gt;Connection:keep-alive&lt;/code&gt;ã€‚åœ¨ä½¿ç”¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„ TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå¦‚æœå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨ä¸Šçš„ç½‘é¡µï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tcpè¿æ¥&#34;&gt;TCPè¿æ¥
&lt;/h2&gt;&lt;p&gt;å½“ç½‘ç»œé€šä¿¡æ—¶é‡‡ç”¨TCPåè®®æ—¶ï¼Œåœ¨çœŸæ­£çš„è¯»å†™æ“ä½œä¹‹å‰ï¼Œserverä¸clientä¹‹é—´å¿…é¡»å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œå½“è¯»å†™æ“ä½œå®Œæˆåï¼ŒåŒæ–¹ä¸å†éœ€è¦è¿™ä¸ªè¿æ¥ æ—¶å®ƒä»¬å¯ä»¥é‡Šæ”¾è¿™ä¸ªè¿æ¥ï¼Œè¿æ¥çš„å»ºç«‹æ˜¯éœ€è¦ä¸‰æ¬¡æ¡æ‰‹çš„ï¼Œè€Œé‡Šæ”¾åˆ™éœ€è¦4æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥è¯´æ¯ä¸ªè¿æ¥çš„å»ºç«‹éƒ½æ˜¯éœ€è¦èµ„æºæ¶ˆè€—å’Œæ—¶é—´æ¶ˆè€—çš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tcpçŸ­è¿æ¥&#34;&gt;TCPçŸ­è¿æ¥
&lt;/h2&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¨¡æ‹Ÿä¸€ä¸‹é•¿è¿æ¥çš„æƒ…å†µï¼Œclientå‘serverå‘èµ·è¿æ¥ï¼Œserveræ¥å—clientè¿æ¥ï¼ŒåŒæ–¹å»ºç«‹è¿æ¥ã€‚Clientä¸serverå®Œæˆä¸€æ¬¡è¯»å†™ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´çš„è¿æ¥å¹¶ä¸ä¼šä¸»åŠ¨å…³é—­ï¼Œåç»­çš„è¯»å†™æ“ä½œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªè¿æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;tcpé•¿è¿æ¥&#34;&gt;TCPé•¿è¿æ¥
&lt;/h2&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¨¡æ‹Ÿä¸€ä¸‹é•¿è¿æ¥çš„æƒ…å†µï¼Œclientå‘serverå‘èµ·è¿æ¥ï¼Œserveræ¥å—clientè¿æ¥ï¼ŒåŒæ–¹å»ºç«‹è¿æ¥ã€‚Clientä¸serverå®Œæˆä¸€æ¬¡è¯»å†™ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´çš„è¿æ¥å¹¶ä¸ä¼šä¸»åŠ¨å…³é—­ï¼Œåç»­çš„è¯»å†™æ“ä½œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªè¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆè¯´ä¸€ä¸‹TCP/IPè¯¦è§£ä¸Šè®²åˆ°çš„TCPä¿æ´»åŠŸèƒ½ï¼Œä¿æ´»åŠŸèƒ½ä¸»è¦ä¸ºæœåŠ¡å™¨åº”ç”¨æä¾›ï¼ŒæœåŠ¡å™¨åº”ç”¨å¸Œæœ›çŸ¥é“å®¢æˆ·ä¸»æœºæ˜¯å¦å´©æºƒï¼Œä»è€Œå¯ä»¥ä»£è¡¨å®¢æˆ·ä½¿ç”¨èµ„æºã€‚å¦‚æœå®¢æˆ·å·²ç»æ¶ˆå¤±ï¼Œä½¿å¾—æœåŠ¡å™¨ä¸Šä¿ç•™ä¸€ä¸ªåŠå¼€æ”¾çš„è¿æ¥ï¼Œè€ŒæœåŠ¡å™¨åˆåœ¨ç­‰å¾…æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®ï¼Œåˆ™æœåŠ¡å™¨å°†åº”è¿œç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä¿æ´»åŠŸèƒ½å°±æ˜¯è¯•å›¾åœ¨æœåŠ¡ å™¨ç«¯æ£€æµ‹åˆ°è¿™ç§åŠå¼€æ”¾çš„è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªç»™å®šçš„è¿æ¥åœ¨ä¸¤å°æ—¶å†…æ²¡æœ‰ä»»ä½•çš„åŠ¨ä½œï¼Œåˆ™æœåŠ¡å™¨å°±å‘å®¢æˆ·å‘ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œå®¢æˆ·ä¸»æœºå¿…é¡»å¤„äºä»¥ä¸‹4ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®¢æˆ·ä¸»æœºä¾ç„¶æ­£å¸¸è¿è¡Œï¼Œå¹¶ä»æœåŠ¡å™¨å¯è¾¾ã€‚å®¢æˆ·çš„TCPå“åº”æ­£å¸¸ï¼Œè€ŒæœåŠ¡å™¨ä¹ŸçŸ¥é“å¯¹æ–¹æ˜¯æ­£å¸¸çš„ï¼ŒæœåŠ¡å™¨åœ¨ä¸¤å°æ—¶åå°†ä¿æ´»å®šæ—¶å™¨å¤ä½ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ä¸»æœºå·²ç»å´©æºƒï¼Œå¹¶ä¸”å…³é—­æˆ–è€…æ­£åœ¨é‡æ–°å¯åŠ¨ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·çš„TCPéƒ½æ²¡æœ‰å“åº”ã€‚æœåŠ¡ç«¯å°†ä¸èƒ½æ”¶åˆ°å¯¹æ¢æµ‹çš„å“åº”ï¼Œå¹¶åœ¨75ç§’åè¶…æ—¶ã€‚æœåŠ¡å™¨æ€»å…±å‘é€10ä¸ªè¿™æ ·çš„æ¢æµ‹ ï¼Œæ¯ä¸ªé—´éš”75ç§’ã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå“åº”ï¼Œå®ƒå°±è®¤ä¸ºå®¢æˆ·ä¸»æœºå·²ç»å…³é—­å¹¶ç»ˆæ­¢è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ä¸»æœºå´©æºƒå¹¶å·²ç»é‡æ–°å¯åŠ¨ã€‚æœåŠ¡å™¨å°†æ”¶åˆ°ä¸€ä¸ªå¯¹å…¶ä¿æ´»æ¢æµ‹çš„å“åº”ï¼Œè¿™ä¸ªå“åº”æ˜¯ä¸€ä¸ªå¤ä½ï¼Œä½¿å¾—æœåŠ¡å™¨ç»ˆæ­¢è¿™ä¸ªè¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å®¢æˆ·æœºæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸å¯è¾¾ï¼Œè¿™ç§æƒ…å†µä¸2ç±»ä¼¼ï¼ŒTCPèƒ½å‘ç°çš„å°±æ˜¯æ²¡æœ‰æ”¶åˆ°æ¢æŸ¥çš„å“åº”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¦‚ä½•é€‰æ‹©é•¿è¿æ¥è¿˜æ˜¯çŸ­è¿æ¥&#34;&gt;å¦‚ä½•é€‰æ‹©é•¿è¿æ¥è¿˜æ˜¯çŸ­è¿æ¥
&lt;/h2&gt;&lt;p&gt;é•¿è¿æ¥å¤šç”¨äºæ“ä½œé¢‘ç¹ï¼Œç‚¹å¯¹ç‚¹çš„é€šè®¯ï¼Œè€Œä¸”è¿æ¥æ•°ä¸èƒ½å¤ªå¤šæƒ…å†µï¼Œã€‚æ¯ä¸ªTCPè¿æ¥éƒ½éœ€è¦ä¸‰æ­¥æ¡æ‰‹ï¼Œè¿™éœ€è¦æ—¶é—´ï¼Œå¦‚æœæ¯ä¸ªæ“ä½œéƒ½æ˜¯å…ˆè¿æ¥ï¼Œå†æ“ä½œçš„è¯é‚£ä¹ˆå¤„ç†é€Ÿåº¦ä¼šé™ä½å¾ˆå¤šï¼Œæ‰€ä»¥æ¯ä¸ªæ“ä½œå®Œåéƒ½ä¸æ–­å¼€ï¼Œæ¬¡å¤„ç†æ—¶ç›´æ¥å‘é€æ•°æ®åŒ…å°±OKäº†ï¼Œä¸ç”¨å»ºç«‹TCPè¿æ¥ã€‚ä¾‹å¦‚ï¼šæ•°æ®åº“çš„è¿æ¥ç”¨é•¿è¿æ¥ï¼Œ å¦‚æœç”¨çŸ­è¿æ¥é¢‘ç¹çš„é€šä¿¡ä¼šé€ æˆsocketé”™è¯¯ï¼Œè€Œä¸”é¢‘ç¹çš„socket åˆ›å»ºä¹Ÿæ˜¯å¯¹èµ„æºçš„æµªè´¹ã€‚&lt;/p&gt;
&lt;p&gt;è€ŒåƒWEBç½‘ç«™çš„httpæœåŠ¡ä¸€èˆ¬éƒ½ç”¨çŸ­é“¾æ¥ï¼Œå› ä¸ºé•¿è¿æ¥å¯¹äºæœåŠ¡ç«¯æ¥è¯´ä¼šè€—è´¹ä¸€å®šçš„èµ„æºï¼Œè€ŒåƒWEBç½‘ç«™è¿™ä¹ˆé¢‘ç¹çš„æˆåƒä¸Šä¸‡ç”šè‡³ä¸Šäº¿å®¢æˆ·ç«¯çš„è¿æ¥ç”¨çŸ­è¿æ¥ä¼šæ›´çœä¸€äº›èµ„æºï¼Œå¦‚æœç”¨é•¿è¿æ¥ï¼Œè€Œä¸”åŒæ—¶æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·éƒ½å ç”¨ä¸€ä¸ªè¿æ¥çš„è¯ï¼Œé‚£å¯æƒ³è€ŒçŸ¥å§ã€‚æ‰€ä»¥å¹¶å‘é‡å¤§ï¼Œä½†æ¯ä¸ªç”¨æˆ·æ— éœ€é¢‘ç¹æ“ä½œæƒ…å†µä¸‹éœ€ç”¨çŸ­è¿å¥½ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>epoll TCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ç®€æ˜ä¾‹å­</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/epoll-tcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%80%E6%98%8E%E4%BE%8B%E5%AD%90/</link>
        <pubDate>Mon, 25 Dec 2017 02:52:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/epoll-tcp%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%AE%80%E6%98%8E%E4%BE%8B%E5%AD%90/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;epollæ˜¯Linuxä¸“æœ‰APIï¼Œæä¾›é«˜æ•ˆçš„æ–‡ä»¶æè¿°ç¬¦ç®¡ç†ï¼Œå¸¸ç”¨äºæ‰¹é‡ç›‘å¬æ–‡ä»¶æè¿°ç¬¦çš„å¯è¯»æƒ…å†µï¼Œæ˜¯é«˜å¹¶å‘æœåŠ¡å™¨çš„æœ‰æ•ˆæ‰‹æ®µä¹‹ä¸€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„epollæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¾‹å­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœåŠ¡å™¨ç«¯&#34;&gt;æœåŠ¡å™¨ç«¯
&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;fcntl.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/socket.h&amp;gt;
#include &amp;lt;netinet/in.h&amp;gt;
#include &amp;lt;arpa/inet.h&amp;gt;
#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;sys/epoll.h&amp;gt;

using namespace std;

const int MAX_EPOLL_EVENTS = 1000;
const int MAX_MSG_LEN = 1024;

void setFdNonblock(int fd)
{
    fcntl(fd, F_SETFL, fcntl(fd, F_GETFL) | O_NONBLOCK);
}

void err_exit(const char *s){
    printf(&amp;#34;error: %s\n&amp;#34;,s);
    exit(0);
}

int create_socket(const char *ip, const int port_number)
{
    struct sockaddr_in server_addr = {0};
    /* è®¾ç½®ipv4æ¨¡å¼ */
    server_addr.sin_family = AF_INET;           /* ipv4 */
    /* è®¾ç½®ç«¯å£å· */
    server_addr.sin_port = htons(port_number);
    /* è®¾ç½®ä¸»æœºåœ°å€ */
    if(inet_pton(server_addr.sin_family, ip, &amp;amp;server_addr.sin_addr) == -1){
        err_exit(&amp;#34;inet_pton&amp;#34;);
    }
    /* å»ºç«‹socket */
    int sockfd = socket(PF_INET, SOCK_STREAM, 0);
    if(sockfd == -1){
        err_exit(&amp;#34;socket&amp;#34;);
    }
    /* è®¾ç½®å¤ç”¨æ¨¡å¼ */
    int reuse = 1;
    if(setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;amp;reuse, sizeof(reuse)) == -1)
    {
        err_exit(&amp;#34;setsockopt&amp;#34;);
    }
    /* ç»‘å®šç«¯å£ */
    if(bind(sockfd, (sockaddr *)&amp;amp;server_addr, sizeof(server_addr)) == -1){
        err_exit(&amp;#34;bind&amp;#34;);
    }
    /* è®¾ç½®è¢«åŠ¨æ‰“å¼€ */
    if(listen(sockfd, 5) == -1){
        err_exit(&amp;#34;listen&amp;#34;);
    }
    return sockfd;
}

int main(int argc, const char *argv[])
{
    /* å¸®åŠ© */
    if(argc &amp;lt; 3){
        printf(&amp;#34;usage:%s ip port\n&amp;#34;, argv[0]);
        exit(0);
    }
    /* è·å–æœåŠ¡å™¨å‚æ•° */
    const char * ip = argv[1];
    const int port = atoi(argv[2]);
    /* åˆ›å»ºå¥—æ¥å­— */
    int sockfd = create_socket(ip, port);
    printf(&amp;#34;success create sockfd %d\n&amp;#34;, sockfd);
    setFdNonblock(sockfd);
    /* åˆ›å»ºepoll */
    int epollfd = epoll_create1(0);
    if(epollfd == -1) err_exit(&amp;#34;epoll_create1&amp;#34;);
    /* æ·»åŠ sockfdåˆ°epollfdå…´è¶£åˆ—è¡¨ */
    struct epoll_event ev;
    ev.data.fd = sockfd;
    ev.events = EPOLLIN ;
    if(epoll_ctl(epollfd, EPOLL_CTL_ADD, sockfd, &amp;amp;ev) == -1){
        err_exit(&amp;#34;epoll_ctl1&amp;#34;);
    }
    /* åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ç”¨äºå­˜æ”¾waitæ‰€è¿”å›çš„events */
    struct epoll_event events[MAX_EPOLL_EVENTS] = {0};
    /* å¼€å§‹ç­‰å¾…æ‰€æœ‰åœ¨epollä¸ŠæŒ‚ä¸Šå»çš„äº‹ä»¶ */

    while(1){
        /* ç­‰å¾…äº‹ä»¶ */
        printf(&amp;#34;begin wait\n&amp;#34;);
        int number = epoll_wait(epollfd, events, MAX_EPOLL_EVENTS, -1);
        printf(&amp;#34;end wait\n&amp;#34;);
        sleep(1);
        if(number &amp;gt; 0){
            /* éå†æ‰€æœ‰äº‹ä»¶ */
            for (int i = 0; i &amp;lt; number; i++)
            {
                int eventfd = events[i].data.fd;
                /* å¦‚æœè§¦å‘äº‹ä»¶çš„fdæ˜¯sockfdï¼Œåˆ™è¯´æ˜æœ‰äººè¿æ¥ä¸Šæ¥äº†ï¼Œæˆ‘ä»¬éœ€è¦acceptä»– */
                if(eventfd == sockfd){
                    printf(&amp;#34;accept new client...\n&amp;#34;);
                    struct sockaddr_in client_addr;
                    socklen_t client_addr_len = sizeof(client_addr);
                    int connfd = accept(sockfd, (struct sockaddr *)&amp;amp;client_addr, &amp;amp;client_addr_len);
                    setFdNonblock(connfd);
                    /* acceptä¹‹åï¼Œéœ€è¦å°†æ–‡ä»¶æè¿°ç¬¦åŠ å…¥åˆ°ç›‘å¬åˆ—è¡¨ä¸­ */
                    struct epoll_event ev;
                    ev.data.fd = connfd;
                    ev.events = EPOLLIN;
                    if(epoll_ctl(epollfd, EPOLL_CTL_ADD, connfd, &amp;amp;ev) == -1){
                        err_exit(&amp;#34;epoll_ctl2&amp;#34;);
                    }
                    printf(&amp;#34;accept new client end.\n&amp;#34;);
                }
                /* å¦‚æœè§¦å‘çš„fdä¸æ˜¯sockfdï¼Œé‚£å°±æ˜¯æ–°åŠ çš„connfd */
                else{
                    /* è¯»å‡ºå†…å®¹ï¼Œç›´åˆ°é‡åˆ°å›è½¦ã€‚ç„¶åæ˜¾ç¤ºè¯¥å†…å®¹ã€‚ */
                    printf(&amp;#34;read start...\n&amp;#34;);
                    while(1){
                        char buff = -1;
                        int ret = read(eventfd, &amp;amp;buff, 1);
                        if(ret &amp;gt; 0){
                            printf(&amp;#34;%c&amp;#34;, buff);
                        }
                        if(buff == &amp;#39;\n&amp;#39;){
                            break;
                        }
                        else if (ret == 0){
                            printf(&amp;#34;client close.\n&amp;#34;);
                            close(eventfd);
                            epoll_ctl(epollfd, EPOLL_CTL_DEL, eventfd, NULL);
                            break;
                        }
                        else if (ret &amp;lt; 0){
                            printf(&amp;#34;read error.\n&amp;#34;);
                            break;
                        }
                    }
                    printf(&amp;#34;read end.\n&amp;#34;);
                }
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å®¢æˆ·ç«¯&#34;&gt;å®¢æˆ·ç«¯
&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;string.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;arpa/inet.h&amp;gt;
#include &amp;lt;sys/socket.h&amp;gt;
#include &amp;lt;string&amp;gt;
#include &amp;lt;iostream&amp;gt;

using namespace std;

void err_exit(const char *s){
    printf(&amp;#34;error: %s\n&amp;#34;,s);
    exit(0);
}

int create_socket(const char *ip, const int port_number)
{
    struct sockaddr_in server_addr = {0};
    /* è®¾ç½®ipv4æ¨¡å¼ */
    server_addr.sin_family = AF_INET;           /* ipv4 */
    /* è®¾ç½®ç«¯å£å· */
    server_addr.sin_port = htons(port_number);
    /* è®¾ç½®ä¸»æœºåœ°å€ */
    if(inet_pton(PF_INET, ip, &amp;amp;server_addr.sin_addr) == -1){
        err_exit(&amp;#34;inet_pton&amp;#34;);
    }

    /* å»ºç«‹socket */
    int sockfd = socket(PF_INET, SOCK_STREAM, 0);
    if(sockfd == -1){
        err_exit(&amp;#34;socket&amp;#34;);
    }

    if(connect(sockfd, (struct sockaddr*)&amp;amp;server_addr, sizeof(server_addr)) == -1){
        err_exit(&amp;#34;connect&amp;#34;);
    }

    return sockfd;
}

int main(int argc, const char *argv[]){
    if(argc &amp;lt; 3){
        printf(&amp;#34;usage:%s ip port\n&amp;#34;, argv[0]);
        exit(0);
    }
    /* è·å–æœåŠ¡å™¨å‚æ•° */
    const char * ip = argv[1];
    const int port = atoi(argv[2]);
    //åˆ›å»ºå¥—æ¥å­—
    int sock = create_socket(ip, port);
    //å‘æœåŠ¡å™¨ï¼ˆç‰¹å®šçš„IPå’Œç«¯å£ï¼‰å‘èµ·è¯·æ±‚
    
    while(1){
        string buff;
        getline(cin, buff);
        if(buff == &amp;#34;exit&amp;#34;) break;
        write(sock, buff.c_str(), buff.size());
        char end = &amp;#39;\n&amp;#39;;
        write(sock, &amp;amp;end, 1);
    }
    close(sock);
    return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;ç¼–è¯‘&#34;&gt;ç¼–è¯‘
&lt;/h2&gt;&lt;p&gt;å°†ä¸Šè¿°æ–‡æœ¬å­˜ä¸ºsocket_server.cppä¸socket_client.cppï¼Œç¼–è¯‘é“¾æ¥è¯¥ç¨‹åºã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;g++ -Wall socket_server.cpp -o server &amp;amp;&amp;amp; g++ -Wall socket_client.cpp -o client
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;è¿è¡Œ&#34;&gt;è¿è¡Œ
&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;./server localhost 1234
&lt;/code&gt;&lt;/pre&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;./client localhost 1234
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;åœ¨clientç«¯è¾“å…¥æ–‡å­—å¹¶å›è½¦ï¼Œä¼šå‡ºç°åœ¨æœåŠ¡å™¨ç«¯ã€‚æŒ‰ä¸‹Ctrl Cå…³é—­å®¢æˆ·ç«¯æˆ–è€…è¾“å…¥exitå…³é—­å®¢æˆ·ç«¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è¿è¡Œæµç¨‹&#34;&gt;è¿è¡Œæµç¨‹
&lt;/h2&gt;&lt;p&gt;æœåŠ¡å™¨é¦–å…ˆåˆ›å»ºè¢«åŠ¨æ‰“å¼€socketæ–‡ä»¶æè¿°ç¬¦ï¼Œç„¶åå°†è¯¥æ–‡ä»¶æè¿°ç¬¦åŠ å…¥åˆ°epollå…´è¶£åˆ—è¡¨ã€‚æ¥ä¸‹æ¥è¿›å…¥å¾ªç¯ã€‚æ¯å½“å…´è¶£åˆ—è¡¨waitç»“æŸæ—¶ï¼Œè¯´æ˜å¯¹åº”æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¿›è¡Œæ“ä½œã€‚å½“æœ‰å®¢æˆ·ç«¯è¿ä¸Šè¢«åŠ¨æ‰“å¼€socketæ–‡ä»¶æè¿°ç¬¦æ—¶ï¼Œè¯´æ˜æœ‰å®¢æˆ·ç«¯è¿ä¸Šï¼Œè¢«åŠ¨æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¢«acceptã€‚acceptåæ‰€åˆ›å»ºçš„æ–°çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸å®¢æˆ·ç«¯é€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ç»§ç»­åŠ å…¥å…´è¶£åˆ—è¡¨ã€‚å½“å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ä¹Ÿä¼šäº§ç”Ÿå¯è¯»ä¿¡å·ï¼Œä¼šå¯¼è‡´waitç»“æŸï¼Œæ­¤æ—¶è¿›å…¥å¤„ç†æ¨¡å¼ï¼Œè¯»å–å¹¶æ˜¾ç¤ºå®¢æˆ·ç«¯æ‰€å‘é€çš„æ•°æ®ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>SOCKET å­¦ä¹ ç¬”è®°</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/socket-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</link>
        <pubDate>Mon, 25 Dec 2017 02:34:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/socket-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;é¢ç»ä¸­æåˆ°çš„epollï¼Œæ¶‰åŠåˆ°äº†socketç¼–ç¨‹ã€‚ä¸ºäº†æ·±å…¥äº†è§£epollåŸç†ï¼Œéœ€è¦é¦–å…ˆäº†è§£socketç¼–ç¨‹ã€‚socketæ˜¯è¿›ç¨‹é—´é€šä¿¡IPCï¼Œå°±ç®—åœ¨ç½‘ç»œä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ‰€ä»¥è¯´ç½‘ç»œä¸­é€šä¿¡çš„ä¸»ä½“æ˜¯è¿›ç¨‹ï¼Œè€Œä¸æ˜¯è®¡ç®—æœºã€‚socketå­¦ä¹ å†…å®¹ä¸€ä¸ªæ˜¯å¦‚ä½•å»ºç«‹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œä¸€ä¸ªæ˜¯å¦‚ä½•ä½¿ç”¨socket APIã€‚&lt;/p&gt;
&lt;h4 id=&#34;fdsocketdomain-type-protocol&#34;&gt;fd=socket(domain, type, protocol);
&lt;/h4&gt;&lt;p&gt;socketè°ƒç”¨å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªsocketï¼Œä¾‹å¦‚
domainå¯ä»¥ç”¨æ¥æŒ‡å®šipv4ï¼Œtypeå¯ä»¥ç”¨æ¥æŒ‡å®štcpï¼Œprotocolä¸€èˆ¬æ˜¯0ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;domain
domainæ˜¯é€šä¿¡èŒƒå›´ä¸é€šä¿¡åœ°å€çš„ç±»å‹ã€‚æœ‰ä¸‹é¢å‡ ä¸ªç»å…¸ç±»å‹ï¼š
UNIX IPV4 IPV6ï¼Œåˆ†åˆ«å¯¹åº”çš„å‚æ•°æ˜¯AF_UNIX AF_INET AF_INET6ã€‚
domain çš„å‚æ•°éƒ½æ˜¯ä»¥AFå¼€å¤´çš„ä»£è¡¨åœ°å€ç°‡ã€‚PFå¼€å¤´çš„ä»£è¡¨åè®®ç°‡ã€‚æœ¬æ¥è®¾è®¡æ˜¯åœ°å€ç°‡å’Œåè®®ç°‡æ˜¯å¤šå¯¹å¤šçš„ï¼Œä½†æ˜¯åæ¥å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªåè®®ç°‡å’Œåœ°å€ç°‡æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ‰€ä»¥åŸºæœ¬ä¸Šdomainå°±æ˜¯æŒ‡å®šäº†åè®®ç°‡ï¼Œåœ°å€ç°‡ä¹Ÿè¢«æŒ‡å®šäº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;type
socketè¡¨ç¤ºæ˜¯æµè¿˜æ˜¯æ•°æ®åŒ…ï¼Œå…¶å®å°±æ˜¯TCPè¿˜æ˜¯UDPã€‚å¦‚æœæ˜¯TCPå°±æ˜¯SOCK_STREAMï¼Œå¦‚æœæ˜¯UDPå°±æ˜¯SOCK_DGRAM&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;bindint-sockfd-const-struct-sockaddr-addr-socklen_t-addrlen&#34;&gt;bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
&lt;/h4&gt;&lt;p&gt;è¯¥è°ƒç”¨ç”¨äºå°†socketç»‘å®šåˆ°ä¸€ä¸ªåœ°å€ä¸Šã€‚ä¹‹åå¯ä»¥å‘é€TCPæŠ¥æ–‡ï¼Œåœ¨ä¸€äº›åœºåˆä¸‹ä¹Ÿå¯ä»¥é€šè¿‡writeå‘é€UDPæŠ¥æ–‡ï¼Œä½†æ˜¯åªèƒ½åœ¨è¯¥socketä¸Šè¯»å–å¯¹ç­‰socketæ•°æ®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sockaddr
è¯¥ç»“æ„ä½“æœ‰ä¸€ä¸ªæ•´å½¢è¡¨ç¤ºåœ°å€ç±»å‹ï¼Œç„¶ååé¢è·Ÿç€ä¸€ä¸ªcharæ•°ç»„ã€‚åé¢å¯ä»¥çœ‹åˆ°å…·ä½“ä¼ è¿›æ¥çš„æ˜¯æ ¹æ®ä½¿ç”¨åœºåˆçš„å…¶ä»–æ•°æ®ç»“æ„ï¼Œä½†æ˜¯æ˜¯é€šç”¨çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;listenint-sockfd-int-backlog&#34;&gt;listen(int sockfd, int backlog)
&lt;/h4&gt;&lt;p&gt;å°†ä¸€ä¸ªsocketæè¿°ç¬¦æ ‡è®°ä¸ºè¢«åŠ¨ã€‚å¯ä»¥è¢«ä¸»åŠ¨socketè¿æ¥ã€‚backlogæ˜¯ç”¨äºé™åˆ¶ç­‰å¾…è¿æ¥çš„æ•°é‡ã€‚&lt;/p&gt;
&lt;h4 id=&#34;acceptint-sockfd-struct-sockaddr-addr-socklen_t--addrlen&#34;&gt;accept(int sockfd, struct sockaddr *addr, socklen_t * addrlen);
&lt;/h4&gt;&lt;p&gt;acceptè°ƒç”¨ä¼šé˜»å¡å¹¶ç­‰å¾…åœ¨æ–‡ä»¶æè¿°ç¬¦sockfdä¸Šçš„æ¥å…¥è¯·æ±‚ã€‚ä¸€æ—¦è¯·æ±‚æˆåŠŸï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„socketï¼Œè¿™ä¸ªæ–°çš„socketä¸å¯¹æ–¹è¿›è¡Œè¿æ¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;addr
è¿”å›å¯¹æ–¹çš„åœ°å€&lt;/li&gt;
&lt;li&gt;addrlen
ä¼ å…¥addrçš„é•¿åº¦ï¼Œç”¨äºå‘ŠçŸ¥èƒ½å¤Ÿå†™å…¥è¾“å…¥çš„æœ€å¤§é•¿åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;connectint-sockfd-const-struct-sockaddr--addr-socklen_t-addrlen&#34;&gt;connect(int sockfd, const struct sockaddr * addr, socklen_t addrlen);
&lt;/h4&gt;&lt;p&gt;å°†sockfdè¿æ¥åˆ°addræ‰€è¿°çš„åœ°å€ä¸Šã€‚&lt;/p&gt;
&lt;h4 id=&#34;closeint-fd&#34;&gt;close(int fd)
&lt;/h4&gt;&lt;p&gt;ç”¨äºå…³é—­è¿æ¥&lt;/p&gt;
&lt;h4 id=&#34;read-write&#34;&gt;read write
&lt;/h4&gt;&lt;p&gt;ç”¨äºå¯¹sockfdè¿›è¡Œè¯»å…¥æˆ–è¯»å‡º&lt;/p&gt;
&lt;h4 id=&#34;recvfromint-sockfd-void-buffer-size_t-length-int-flags-struct-sockaddr-src_addr-socklen_t-addrlen&#34;&gt;recvfrom(int sockfd, void *buffer, size_t length, int flags, struct sockaddr *src_addr, socklen_t *addrlen);
&lt;/h4&gt;&lt;h4 id=&#34;sendtoint-sockfd-const-void-buffer-size_t-length-int-flags-const-struct-sockaddr-dest_addr-socklen_t-addrlen&#34;&gt;sendto(int sockfd, const void *buffer, size_t length, int flags, const struct sockaddr *dest_addr, socklen_t addrlen);
&lt;/h4&gt;&lt;p&gt;ç”¨äºå‘é€å’Œæ¥å—udpæŠ¥æ–‡ã€‚æœåŠ¡å™¨ç«¯ä¸èƒ½ä½¿ç”¨listenå‡½æ•°å’Œacceptå‡½æ•°ï¼Œå®¢æˆ·ç«¯ä¸èƒ½ä½¿ç”¨connectå‡½æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;unix-domain&#34;&gt;unix domain
&lt;/h4&gt;&lt;p&gt;ä½¿ç”¨ä¸Šé¢çš„APIå°±å¯ä»¥å®ç°æœ¬æœºä¸Šé€šè¿‡æ–‡ä»¶çš„é€šä¿¡ã€‚
unix domainæ‰€ä½¿ç”¨çš„sockaddræ˜¯sockaddr_runï¼Œå¦‚ä¸‹è¡¨ç¤ºï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct sockaddr_un{
    sa_family_t sun_family;
    char sun_path[108];
}
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;ç½‘ç»œå­—èŠ‚åº&#34;&gt;ç½‘ç»œå­—èŠ‚åº
&lt;/h4&gt;&lt;p&gt;ç½‘ç»œå­—èŠ‚é¡ºåºæ˜¯æŒ‰ç…§å¤§ç«¯æ¥çš„ï¼Œx86æ˜¯å°ç«¯ç»“æ„ã€‚è½¬æ¢ä½¿ç”¨çš„æ˜¯å¦‚ä¸‹çš„å‡½æ•°è¿›è¡Œçš„&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;htons&lt;/li&gt;
&lt;li&gt;htonl&lt;/li&gt;
&lt;li&gt;ntohs&lt;/li&gt;
&lt;li&gt;ntohl
hæ˜¯hostï¼Œnæ˜¯netï¼Œsæ˜¯16ä½ï¼Œlæ˜¯32ä½ã€‚så’Œlæ˜¯shortå’Œlongï¼Œè™½ç„¶ç°åœ¨å·²ç»ä¸å†ä½¿ç”¨è¿™æ ·çš„æ ‡å‡†äº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;internet-socket-åœ°å€ç»“æ„&#34;&gt;Internet socket åœ°å€ç»“æ„
&lt;/h4&gt;&lt;p&gt;ç½‘ç»œä¸‹ä½¿ç”¨çš„socketåœ°å€æ˜¯sockaddr_inï¼Œå®šä¹‰å¦‚ä¸‹&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct sockaddr_in{
    sa_family_t sin_family;
    in_port_t sin_port;
    struct in_addr sin_addr;
    unsigned char __pad[X];
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºä¸ä¸€æ ·çš„åœ°æ–¹æ˜¯åé¢çš„charæ•°ç»„å˜æˆäº†ä¸€ä¸ªç«¯å£å’Œåœ°å€ã€‚sinæ˜¯socket Internetçš„ç®€å†™ï¼Œç®€å†™çš„å’Œsunä¸€æ ·å¾ˆå·®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;internet-socket-åœ°å€è½¬æ¢&#34;&gt;Internet socket åœ°å€è½¬æ¢
&lt;/h4&gt;&lt;p&gt;å­—ç¬¦ä¸²å¼çš„åœ°å€æ ¼å¼å’ŒäºŒè¿›åˆ¶åœ°å€æ ¼å¼è½¬æ¢API:&lt;/p&gt;
&lt;h4 id=&#34;inet_ptonint-domain-const-char-src-void-addrptr&#34;&gt;inet_pton(int domain, const char *src, void *addrptr);
&lt;/h4&gt;&lt;p&gt;è¯¥å‡½æ•°ç”¨äºå°†srcä¸­åŒ…å«çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º&lt;strong&gt;ç½‘ç»œå­—èŠ‚&lt;/strong&gt;çš„äºŒè¿›åˆ¶åœ°å€ï¼Œå­˜å…¥addrptrã€‚pæ˜¯presentationçš„æ„æ€ï¼Œå°±æ˜¯äººç±»æ–¹ä¾¿çš„åœ°å€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;const-char--inet_ntopint-domain-const-void-addrptr-char-dst_str-size_t-len&#34;&gt;const char * inet_ntop(int domain, const void *addrptr, char *dst_str, size_t len);
&lt;/h4&gt;&lt;p&gt;è¯¥å‡½æ•°æ‰§è¡Œç½‘ç»œå­—èŠ‚çš„äºŒè¿›åˆ¶åœ°å€è½¬æ¢ä¸ºäººç±»å¯è¯»çš„åœ°å€ï¼Œå†™å…¥åˆ°dst_strä¸­ï¼Œç¼“å†²åŒºçš„å¤§å°æœ‰lenä¼ å…¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;getaddrinfoconst-char-host-const-char-service-const-struct-addrinfo-hints-struct-result&#34;&gt;getaddrinfo(const char *host, const char *service, const struct addrinfo *hints, struct **result);
&lt;/h4&gt;&lt;p&gt;è¯¥å‡½æ•°ç»™å®šä¸€ä¸ªä¸»æœºåå’ŒæœåŠ¡å™¨åï¼Œè¿”å›socketåœ°å€å’Œç«¯å£å·ã€‚
getaddrinfoä»¥hostã€serviceã€hintså‚æ•°ä½œä¸ºè¾“å…¥ï¼Œå…¶ä¸­hostå‚æ•°åŒ…æ‹¬ä¸€ä¸ªä¸»æœºåæˆ–ä¸€ä¸ªä»¥IPV4å­—ç¬¦ä¸²ã€‚serviceæ˜¯æœåŠ¡åæˆ–è€…æ˜¯ç«¯å£å·ã€‚è¯¥å‡½æ•°çš„è°ƒç”¨ä¹‹åéœ€è¦ä½¿ç”¨freeaddrinfoæ¥é‡Šæ”¾ç©ºé—´ã€‚&lt;/p&gt;
&lt;h4 id=&#34;getnameinfoconst-struct-sockaddr-addr-socklen_t-addrlen-char-host-size_t-hostlen-char-service-size_t-servlen-int-flags&#34;&gt;getnameinfo(const struct sockaddr *addr, socklen_t addrlen, char *host, size_t hostlen, char *service, size_t servlen, int flags);
&lt;/h4&gt;&lt;p&gt;ç»™å®šä¸€ä¸ªsocketåœ°å€ç»“æ„ï¼Œè¿”å›ä¸€ä¸ªä¸»æœºå’ŒæœåŠ¡å™¨åçš„å­—ç¬¦ä¸²ã€‚&lt;/p&gt;
&lt;h4 id=&#34;setsockoptint-sockfd-int-level-int-optname-const-void-optval-socklen_t-optlen&#34;&gt;setsockopt(int sockfd, int level, int optname, const void *optval, socklen_t optlen);
&lt;/h4&gt;&lt;p&gt;sockfdæ˜¯ä»£è¡¨æŒ‡å‘å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å‚æ•°levelåˆ¶å®šäº†å¥—æ¥å­—é€‰é¡¹æ‰€é€‚ç”¨çš„åè®®ã€‚ä¾‹å¦‚TCPæˆ–è€…æ˜¯IPï¼Œè¿™è¡¨ç¤ºé€‰é¡¹ä½œç”¨çš„å¥—æ¥å­—APIå±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¯¥é€‰é¡¹ä¼šè®¾ç½®ä¸ºSOL_SOCKETï¼Œè¡¨ç¤ºä½œç”¨äºå¥—æ¥å­—APIå±‚ã€‚å‚æ•°optnameè¡¨ç¤ºäº†æˆ‘ä»¬æœŸå¾…è®¾ç½®çš„é€‰é¡¹ï¼Œoptvalueæ˜¯ç”¨æ¥è®¾ç½®åˆšåˆšçš„é€‰é¡¹çš„å€¼ï¼Œå¯ä»¥æ˜¯æ•´æ•°æˆ–è€…æ˜¯ç»“æ„ä½“çš„æŒ‡é’ˆï¼ŒæŒ‡å‘äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œè€Œå‚æ•°optlenæ˜¯åˆšåˆšé‚£ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘åŒºåŸŸçš„å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè¦è®¾ç½®sockfdä¸ºreuseaddrå±æ€§æ—¶ï¼Œå¯ä»¥å¦‚ä¸‹è°ƒç”¨ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;    int reuse = 1;
    if(setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;amp;reuse, sizeof(reuse)) == -1)
    {
        err_exit(&amp;#34;setsockopt&amp;#34;);
    }
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;getsockoptint-sockfd-int-level-int-optname-void-optval-socklen_t-optlen&#34;&gt;getsockopt(int sockfd, int level, int optname, void *optval, socklen_t optlen);
&lt;/h4&gt;&lt;p&gt;ç”¨æ³•å’Œä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯è·å–è€Œå·²ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>å…¶ä»– I/O æ¨¡å‹æ€»ç»“</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E5%85%B6%E4%BB%96-i-o-%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93/</link>
        <pubDate>Thu, 21 Dec 2017 06:18:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E5%85%B6%E4%BB%96-i-o-%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93/</guid>
        <description>&lt;ul&gt;
&lt;li&gt;I/O å¤šè·¯å¤ç”¨&lt;/li&gt;
&lt;li&gt;ä¿¡å·é©±åŠ¨I/O&lt;/li&gt;
&lt;li&gt;Linuxä¸“æœ‰epoll&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;ioå¤šè·¯å¤ç”¨&#34;&gt;I/Oå¤šè·¯å¤ç”¨
&lt;/h2&gt;&lt;p&gt;é€šè¿‡selectç³»ç»Ÿè°ƒç”¨æˆ–è€…pollç³»ç»Ÿè°ƒç”¨ï¼Œæ¥å¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;selectå‡½æ•°
&lt;code&gt;int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *errorfds, struct timeval *timeout);&lt;/code&gt;
å‚æ•°åˆ†åˆ«çš„æ„æ€æ˜¯ï¼šéœ€è¦æµ‹è¯•çš„fdèŒƒå›´0ï½fd-1ï¼Œæ»¡è¶³ä¸‰ç§æƒ…å†µè¦æ±‚çš„æ–‡ä»¶æè¿°ç¬¦å·ï¼Œè¶…æ—¶æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;pollå‡½æ•°
&lt;code&gt;int poll(struct pollfd fds[], nfds_t nfds, int timeout); &lt;/code&gt;
å‚æ•°åˆ†åˆ«æ˜¯ï¼šå…ƒç´ åŒ…å«æ–‡ä»¶æè¿°ç¬¦ã€éœ€è¦æ£€æŸ¥çš„çŠ¶æ€ã€è¿”å›çš„çŠ¶æ€çš„ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„é•¿åº¦ä»¥åŠè¶…æ—¶æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äºŒè€…çš„åŒºåˆ«åœ¨äºpollé‡Œé¢ä¼ è¿›å»çš„æ•°ç»„å¤§å°ä¸å—fd_setå®šä¹‰çš„å¤§å°é™åˆ¶ã€‚pollçš„eventså’Œreventsæ›´ä¸°å¯Œä¸€äº›ã€‚selectç”¨çš„æ›´ä¸ºå¹¿æ³›ä¸€äº›ã€‚æ–°ç‰ˆä¸­selectçš„æ€§èƒ½ç»è¿‡ä¼˜åŒ–ä¸pollå·®ä¸å¤šã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;epollå‡½æ•°
epollå‡½æ•°åŒ…æ‹¬ä¸‰ä¸ªAPIï¼šepoll_create()ã€epoll_ctl()ã€epoll_wait()ä¸‰ä¸ªè°ƒç”¨ã€‚
epollæ˜¯ä¸‰ä¸ªè°ƒç”¨ä¸­æ€§èƒ½æœ€å¥½ï¼Œæ•ˆæœæœ€å¤šçš„ã€‚ä½†æ˜¯åªæœ‰Linuxæ‰å¯ä»¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸»è¦æ˜¯å› ä¸ºæœåŠ¡å™¨ä¸Šé¢ä¼šè¿æ¥å¤šä¸ªsocketé“¾æ¥ï¼Œå¦‚æœä¸ºæ¯ä¸€ä¸ªå¥—æ¥å­—å»ºç«‹ä¸€ä¸ªçº¿ç¨‹çš„è¯ï¼Œä¼šæ¯”è¾ƒå ç”¨èµ„æºï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨epollæ¥ä¼˜åŒ–æ€§èƒ½ã€‚&lt;/p&gt;
</description>
        </item>
        <item>
        <title>åŸºäºFlaskçš„ä¸ªäººåšå®¢æ­å»º</title>
        <link>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E5%9F%BA%E4%BA%8Eflask%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</link>
        <pubDate>Sun, 30 Jul 2017 17:38:00 +0000</pubDate>
        
        <guid>https://nansenli.com/zh-cn/post/jianshu/%E7%BD%91%E7%BB%9C/%E5%9F%BA%E4%BA%8Eflask%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</guid>
        <description>&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;æºç å¯ç›´æ¥è¿è¡Œï¼Œæ”¯æŒmarkdownè¯­æ³•ï¼Œæ”¯æŒé‚®ç®±æ³¨å†Œï¼Œä»»ä½•é—®é¢˜å‡å¯å‚è€ƒ&lt;a class=&#34;link&#34; href=&#34;https://book.douban.com/subject/26274202/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ã€ŠFlask Webå¼€å‘ï¼šåŸºäºPythonçš„Webåº”ç”¨å¼€å‘å®æˆ˜ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åšå®¢ç½‘å€ï¼šhttp://www.unrealblue.cc
é¡¹ç›®åœ°å€ï¼šhttps://github.com/linanwx/unrealblue-blog&lt;/p&gt;
&lt;h2 id=&#34;æ•ˆæœé¢„è§ˆ&#34;&gt;æ•ˆæœé¢„è§ˆ
&lt;/h2&gt;&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/4388248-14b7a806bb06cf9a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;image.png&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/4388248-2c73dba03a62ae14.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;markdownè¯­æ³•&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/4388248-90a191e0ee2bc604.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;ç™»å½•&#34;
	
	
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://upload-images.jianshu.io/upload_images/4388248-6cad70a486daaeea.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;é¦–é¡µ&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;éƒ¨ç½²è¿‡ç¨‹&#34;&gt;éƒ¨ç½²è¿‡ç¨‹
&lt;/h2&gt;&lt;p&gt;é¦–å…ˆä¸ºäº†éªŒè¯ç¨‹åºåŠŸèƒ½ï¼Œéœ€è¦åœ¨æœ¬æœºä¸Šéƒ¨ç½²ï¼Œä¹‹åä½¿ç”¨nginxåå‘ä»£ç†å·¥å…·ï¼Œå¯ä»¥å°†ç«¯å£å·æš´éœ²å‡ºå»ï¼Œè¿™æ ·å…¶ä»–äººå°±å¯ä»¥åœ¨å…¬ç½‘è®¿é—®ä½ çš„åšå®¢äº†ï¼Œä¹‹ååœ¨æœåŠ¡å™¨è¿›è¡ŒåŒæ ·çš„æ­¥éª¤ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£…virtualenv pythonè™šæ‹Ÿç¯å¢ƒï¼Œ&lt;code&gt;pip install virtualenv&lt;/code&gt; æˆ–è€… &lt;code&gt;pip3 install virtualenv&lt;/code&gt; ã€‚ç„¶åä½¿ç”¨virtualenvåœ¨ä¸€ä¸ªåˆé€‚çš„ç›®å½•ï¼Œä¾‹å¦‚åœ¨è¯¥é¡¹ç›®ä¸‹é¢å»ºç«‹venvç¯å¢ƒ&lt;code&gt;virtualenv venv&lt;/code&gt;ï¼Œ&lt;/li&gt;
&lt;li&gt;æ¿€æ´»virtualenvç¯å¢ƒï¼Œè¿è¡Œvenvç›®å½•ä¸‹çš„activateï¼Œ&lt;code&gt;. venv/bin/activate&lt;/code&gt;ï¼Œ æ³¨æ„ç‚¹çš„ä½ç½®ï¼Œä¹‹åä½ ä¼šçœ‹åˆ°å‘½ä»¤è¡Œå‰é¢å¤šäº†(venv)è¿™ä¸ªæ ‡è®°ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…æ‰€æœ‰requirements.txtä¸­çš„æ¨¡å—, &lt;code&gt;pip3 install -r requirements.txt&lt;/code&gt;ã€‚å¦‚æœå®‰è£…å¤ªæ…¢ï¼Œä½ å¯èƒ½éœ€è¦é…ç½®pipçš„å›½å†…æºã€‚æ›´æ”¹pipæºçš„æ–¹æ³•å‚è§pipå®˜æ–¹é¡µé¢ã€‚&lt;/li&gt;
&lt;li&gt;å¯¼å…¥åå¢ƒå˜é‡ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶ &lt;code&gt;env&lt;/code&gt; ï¼Œè¾“å…¥å¦‚ä¸‹å­—æ®µï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;MAIL_USERNAME=email@example.com&lt;/code&gt; (æœåŠ¡å™¨å‘éªŒè¯ç ç”¨çš„é‚®ç®±ï¼Œå¼€å¯äº†smtpæœåŠ¡çš„é‚®ç®±è´¦å·ï¼Œç¨‹åºé‡Œé»˜è®¤ä½¿ç”¨qqé‚®ç®±ï¼Œä¿®æ”¹configæ–‡ä»¶å¯æˆå…¶å®ƒç±»å‹é‚®ç®±)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MAIL_PASSWORD=password&lt;/code&gt; (ä¸Šé¢é‚®ç®±çš„å¯†ç ï¼Œæ³¨æ„qqé‚®ç®±ä½¿ç”¨ç‰¹æ®Š16ä½ä¸“ç”¨å¯†ç )&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FLASK_ADMIN=admin@example.com&lt;/code&gt; (æœåŠ¡å™¨è¿è¡Œåï¼Œä½¿ç”¨è¯¥é‚®ç®±åˆ›å»ºè´¦å·å°±æ˜¯ç®¡ç†è€…)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MAIL_SERVER=smtp.qq.com&lt;/code&gt;(é‚®ç®±æœåŠ¡å™¨åœ°å€)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FLASKY_MAIL_SENDER=example@foxmail.com&lt;/code&gt;(å‘é€äºº)&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;å®‰è£…æ•°æ®åº“è¿ç§»ã€‚è¾“å…¥ä»¥ä¸‹å‘½ä»¤&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;python manager.py db init&lt;/code&gt; (ä½¿ç”¨initå‘½ä»¤åˆ›å»ºè¿ç§»ä»“åº“ï¼Œæ­¤æ—¶ä¼šå¤šå‡º migrations æ–‡ä»¶å¤¹)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;python manager.py db migrate -m &amp;quot;initial migration&amp;quot;&lt;/code&gt;(migrateå‘½ä»¤ç”¨æ¥è‡ªåŠ¨åˆ›å»ºè¿ç§»è„šæœ¬)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;python manager.py db upgrade&lt;/code&gt;(æ›´æ–°æ•°æ®åº“ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥å‘½ä»¤ä¼šæ–°å»ºä¸€ä¸ªæ•°æ®åº“data-dev.sqlite)&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;éƒ¨ç½²ç¨‹åºï¼Œ &lt;code&gt;python manager.py deploy&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;åœ¨æœ¬åœ°è¿è¡Œç¨‹åº, &lt;code&gt;python manager.py runserver&lt;/code&gt;æ‰“å¼€ http://127.0.0.1:5000 ç«¯å£æŸ¥çœ‹ï¼ŒæŒ‰Ctrl+Cé€€å‡ºç¨‹åºã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœåœ¨æœåŠ¡å™¨è¿è¡Œï¼Œè¦ä¿ç•™æ•°æ®ï¼Œåˆ™å¯ä»¥å¤åˆ¶æ•°æ®åº“ migrations æ–‡ä»¶å¤¹ä»¥åŠæ•°æ®åº“ data-dev.sqlite åˆ°æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨ &lt;code&gt;./venv/bin/gunicorn -w 4 -b 127.0.0.1:8080 manager:app&lt;/code&gt; æ­¤æ—¶åº”è¯¥å¯ä»¥æŸ¥çœ‹8080ç«¯å£æ˜¾ç¤ºäº†ç½‘é¡µï¼Œä¸”è¯¥ç«¯å£æ˜¯æš´éœ²å¤–ç½‘çš„ã€‚åœ¨æœ¬åœ°æµè§ˆå™¨è¾“å…¥æœåŠ¡å™¨åœ°å€ï¼Œæ­¤æ—¶å°±å¯ä»¥çœ‹åˆ°åšå®¢äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        
    </channel>
</rss>
